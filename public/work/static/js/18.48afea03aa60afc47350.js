webpackJsonp([18],{lRxk:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("//Fk"),o=r.n(a),s={data:function(){return{defaultProps:{children:"children",label:"name",id:"id"},props:{value:"id",label:"name"},queryParam:{},userList:[],userTotal:0,updateDialog:!1,userForm:{},roleList:[],orgList:[],orgParent:[],tableName:"users"}},computed:{roleTreeData:function(){return this.$utils.arrayToTree(this.roleList)},orgTreeData:function(){return this.$utils.arrayToTree(this.orgList)},tableHeight:function(){return this.$utils.getClientHeight()-140}},methods:{initParam:function(){this.queryParam={conditions:{orgId:this.user.orgId},options:{pageSize:20,page:1}},-1!==this.user.roleIds.indexOf(1)&&(this.queryParam.conditions={})},initData:function(){var e=this;this.getUserCount().then(function(t){e.userTotal=t,e.findPageUser(),e.findAllRole().then(function(t){e.roleList=t}),e.findAllOrg().then(function(t){e.orgList=t})})},handleSizeChange:function(e){this.queryParam.options.pageSize=e,this.queryParam.options.page=1,this.findPageUser()},handleCurrentChange:function(e){this.queryParam.options.page=e,this.findPageUser()},findPageUser:function(){var e=this;this.$dataService.find(this.$apiUrl.SYS_USER_PAGE,this.queryParam).then(function(t){e.userList=t})},getUserCount:function(){var e=this;return new o.a(function(t,r){e.$http.post(e.$apiUrl.SYS_USER_COUNT,{}).then(function(e){e&&e.data&&t(e.data)}).catch(function(e){r(e)})})},onUpdateUser:function(e){var t=this;this.updateDialog=!0,this.userForm=e,this.orgParent=[1,this.userForm.orgId],this.$nextTick(function(){t.userForm.roleIds&&t.$refs.roleTree.setCheckedKeys(t.userForm.roleIds)})},renderContent:function(e,t){var r=t.node,a=t.data;t.store;return e("span",{style:"font-size: 14px;"},[e("i",{class:a.icon})," ",r.label])},roleNodeClick:function(e,t,r){this.userForm.roleIds=this.$refs.roleTree.getCheckedKeys()},onUserSave:function(){var e=this;this.userForm.orgId=this.orgParent.slice(0).pop(),this.$dataService.save(this.$apiUrl.SYS_UPDATE_USER+this.userForm._id,this.userForm).then(function(t){e.updateDialog=!1})},doAfterDelete:function(e){this.userList=this.userList.filter(function(t){return t._id!==e._id})},onStopUser:function(e){e.state=Math.abs(e.state-1),this.userForm=e,this.onUserSave()},roleFormatter:function(e){return e.roleIds&&this.$utils.dataFormatter(this.roleList,e.roleIds)},orgFormatter:function(e){return e.orgId&&this.$utils.dataFormatter(this.orgList,[e.orgId])}}},i={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("panel",[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userList,"max-height":e.tableHeight,border:""}},[r("el-table-column",{attrs:{type:"index",width:"50"}}),e._v(" "),r("el-table-column",{attrs:{label:"照片",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("img",{staticStyle:{height:"35px","vertical-align":"middle"},attrs:{src:e.$ccService.ccHeadUrl+t.row.email,alt:""}})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"userName",width:"80",label:"名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),r("el-table-column",{attrs:{prop:"orgId",formatter:e.orgFormatter,label:"组织"}}),e._v(" "),r("el-table-column",{attrs:{prop:"roleIds",formatter:e.roleFormatter,label:"角色"}}),e._v(" "),r("el-table-column",{attrs:{label:"状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(1===t.row.state?"启用":"停用")+"\n      ")]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-edit"},on:{click:function(r){e.onUpdateUser(t.row)}}},[e._v("编辑")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){e.onDelete(t.row)}}},[e._v("删除")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(r){e.onStopUser(t.row)}}},[e._v(e._s(1===t.row.state?"停用":"启用"))])]}}])})],1),e._v(" "),r("el-pagination",{attrs:{"current-page":1,"page-sizes":[5,10,20],"page-size":20,layout:"total, sizes, prev, pager, next, jumper",total:e.userTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),r("el-dialog",{attrs:{title:"编辑",visible:e.updateDialog,width:"70%"},on:{"update:visible":function(t){e.updateDialog=t}}},[r("div",{staticClass:"user-edit"},[r("el-card",{staticClass:"user-form"},[r("el-form",{ref:"form",attrs:{model:e.userForm,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"组织"}},[r("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.orgTreeData,"change-on-select":"",clearable:"",props:e.props},model:{value:e.orgParent,callback:function(t){e.orgParent=t},expression:"orgParent"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"名称"}},[r("el-input",{attrs:{disabled:!0},model:{value:e.userForm.userName,callback:function(t){e.$set(e.userForm,"userName",t)},expression:"userForm.userName"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱"}},[r("el-input",{attrs:{disabled:!0},model:{value:e.userForm.email,callback:function(t){e.$set(e.userForm,"email",t)},expression:"userForm.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"工号"}},[r("el-input",{model:{value:e.userForm.workNo,callback:function(t){e.$set(e.userForm,"workNo",t)},expression:"userForm.workNo"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"是否启用"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ddd","active-value":1,"inactive-value":0},model:{value:e.userForm.state,callback:function(t){e.$set(e.userForm,"state",t)},expression:"userForm.state"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色"}},[r("span",{staticStyle:{color:"#ccc"}},[e._v(e._s(e.roleFormatter(e.userForm)))])])],1)],1),e._v(" "),r("el-card",{staticClass:"role-select"},[r("el-tree",{ref:"roleTree",attrs:{data:e.roleTreeData,"show-checkbox":"","check-strictly":!0,"default-expand-all":!0,"highlight-current":"","render-content":e.renderContent,clearable:"","node-key":"id",props:e.defaultProps},on:{"check-change":e.roleNodeClick}})],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(t){e.updateDialog=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onUserSave}},[e._v("保存")])],1)])],1)},staticRenderFns:[]};var l=r("VU/8")(s,i,!1,function(e){r("qNSt"),r("vnv9")},"data-v-2ce62b83",null);t.default=l.exports},qNSt:function(e,t){},vnv9:function(e,t){}});
//# sourceMappingURL=18.48afea03aa60afc47350.js.map