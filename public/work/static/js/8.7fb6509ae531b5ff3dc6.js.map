{"version":3,"sources":["webpack:///src/modules/sprint/components/sprint-task-analyse.vue","webpack:///./src/modules/sprint/components/sprint-task-analyse.vue?e8fd","webpack:///./src/modules/sprint/components/sprint-task-analyse.vue","webpack:///src/modules/sprint/components/user-chart.vue","webpack:///./src/modules/sprint/components/user-chart.vue?a9d2","webpack:///./src/modules/sprint/components/user-chart.vue","webpack:///src/modules/sprint/pages/SprintChart.vue","webpack:///./src/modules/sprint/pages/SprintChart.vue?b610","webpack:///./src/modules/sprint/pages/SprintChart.vue","webpack:///src/modules/sprint/components/team-rate-chart.vue","webpack:///./src/modules/sprint/components/team-rate-chart.vue?17d1","webpack:///./src/modules/sprint/components/team-rate-chart.vue","webpack:///src/modules/sprint/components/burndown-chart.vue","webpack:///./src/modules/sprint/components/burndown-chart.vue?f075","webpack:///./src/modules/sprint/components/burndown-chart.vue"],"names":["sprint_task_analyse","curSprint","backlogList","onresizeDraw","countType","drawChart","_this","this","refresh","dispose","initData","tasks","j","estimate","key","legendData","todoData","doingData","doneData","components_sprint_task_analyse","render","_h","$createElement","_c","_self","staticStyle","height","width","attrs","span","id","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__","user_chart","userList","ccHeadUrl","calcUserData","calcUserAvgRate","teams","delayDay","getTime","doneTime","startDate","Date","start","end","getDate","tmpDate","i","workDayCount","components_user_chart","_vm","staticClass","_m","_v","_l","userData","email","src","headUrl","alt","_s","_f","claimTime","delayTime","avgRate","rate","sprint_components_user_chart","burnDownChart","burndown_chart","userChart","teamRateChart","team_rate_chart","sprintTaskAnalyse","pages_SprintChart","gutter","margin-bottom","title","on","click","goBack","SprintChart_Component","SprintChart_normalizeComponent","SprintChart","calcRateOfDay","calcDateAndTime","publishDate","_ref","getFullYear","getMonth","testDayTotal","backlog","_i","count","dateList","taskRateList","sprintRateList","components_team_rate_chart","calcTotalTime","_this2","rateOfDay","planTotal","dayTotal","totalTime","planDataList","actualDataList","testDataList","components_burndown_chart"],"mappings":"+EAUAA,uJAaAC,kEAGAC,iDAKAC,6DAIAC,iBACAC,sCAGA,IAAAC,EAAAC,kCAGAC,8CAMAC,6BAGAC,+NAeAC,6BAEAC,8DAKAC,sBAEAA,sBAJAA,oBAOA,YACA,YACA,kDAIAA,qBAEAA,qBAJAA,8CAUAC,wBACAA,0BACAA,yBACAA,sEAIA,yDAGA,yBAIA,qCAEA,aAEA,cAEA,QACA,QACA,UACA,gBAEA,gBAEA,qBAEAC,0BAGA,wBAGA,WACA,YACA,cAEAC,gBAEA,WACA,YACA,cAEAC,iBAEA,WACA,YACA,cAIAC,gBC9IAC,GADiBC,OAFjB,WAA0B,IAAaC,EAAbd,KAAae,eAA0BC,EAAvChB,KAAuCiB,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,UAAoBE,aAAaC,OAAA,OAAAC,MAAA,UAAgCJ,EAAA,UAAeE,aAAaC,OAAA,QAAgBE,OAAQC,KAAA,MAAWN,EAAA,OAAYK,OAAOE,GAAA,sBAAsB,IAEjPC,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACAlC,EACAmB,GATA,EAVA,SAAAgB,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,EAAAJ,EAAA,qICDAK,kDAMA,oEAIApC,kEAGAC,0DAGAoC,sEAKAC,oCAGAC,oBACAC,2CAEA,IAAAnC,EAAAC,2DACAmC,iIAKA,4BAEA7B,uBAEAA,oEAIAA,wCAGA8B,cAEAA,4DAQA9B,sBAEAA,2GAQA+B,2FAEA,mFAGAC,8CAGA,IAAAC,EAAA,IAAAC,KAAAC,cACAC,KACA,mDACA,sCACAC,gCAEAC,OAAA,qCAEAC,kCAIA,UAGAC,KC7GAC,GADiBlC,OAFjB,WAA0B,IAAAmC,EAAAhD,KAAac,EAAAkC,EAAAjC,eAA0BC,EAAAgC,EAAA/B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBiC,YAAA,uBAAiCjC,EAAA,MAAAgC,EAAAE,GAAA,GAAAF,EAAAG,GAAA,KAAAH,EAAAI,GAAAJ,EAAA,sBAAAK,GAA8E,OAAArC,EAAA,MAAgBT,IAAA8C,EAAAC,QAAmBtC,EAAA,OAAYiC,YAAA,YAAA5B,OAA+BkC,IAAAP,EAAAQ,QAAAH,EAAAC,MAAAG,IAAA,MAA6CT,EAAAG,GAAA,KAAAnC,EAAA,QAAyBiC,YAAA,cAAwBD,EAAAG,GAAAH,EAAAU,GAAAV,EAAAW,GAAA,aAAAX,CAAAK,EAAAC,MAAAN,EAAAjB,cAAAiB,EAAAG,GAAA,KAAAnC,EAAA,QAA6FiC,YAAA,gBAA0BD,EAAAG,GAAAH,EAAAU,GAAAL,EAAAO,cAAAZ,EAAAG,GAAA,KAAAnC,EAAA,QAA8DiC,YAAA,gBAA0BD,EAAAG,GAAAH,EAAAU,GAAAL,EAAAf,aAAAU,EAAAG,GAAA,KAAAnC,EAAA,QAA6DiC,YAAA,gBAA0BD,EAAAG,GAAAH,EAAAU,GAAAL,EAAAQ,cAAAb,EAAAG,GAAA,KAAAnC,EAAA,QAA8DiC,YAAA,gBAA0BD,EAAAG,GAAAH,EAAAU,GAAAL,EAAAS,YAAAd,EAAAG,GAAA,KAAAnC,EAAA,QAA4DiC,YAAA,gBAA0BD,EAAAG,GAAAH,EAAAU,GAAAL,EAAAU,cAAoC,MAE52BvC,iBADjB,WAAoC,IAAAwB,EAAAhD,KAAac,EAAAkC,EAAAjC,eAA0BC,EAAAgC,EAAA/B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,MAAAA,EAAA,QAA2BiC,YAAA,oBAA8BD,EAAAG,GAAA,QAAAH,EAAAG,GAAA,KAAAnC,EAAA,QAAwCiC,YAAA,sBAAgCD,EAAAG,GAAA,QAAAH,EAAAG,GAAA,KAAAnC,EAAA,QAAwCiC,YAAA,sBAAgCD,EAAAG,GAAA,QAAAH,EAAAG,GAAA,KAAAnC,EAAA,QAAwCiC,YAAA,sBAAgCD,EAAAG,GAAA,QAAAH,EAAAG,GAAA,KAAAnC,EAAA,QAAwCiC,YAAA,sBAAgCD,EAAAG,GAAA,SAAAH,EAAAG,GAAA,KAAAnC,EAAA,QAAyCiC,YAAA,sBAAgCD,EAAAG,GAAA,eCGrgB,IAuBAa,EAvBAtC,EAAA,OAcAC,CACAG,EACAiB,GATA,EAXA,SAAAnB,GACAF,EAAA,QACAA,EAAA,SAaA,kBAEA,MAUA,yECsBAuC,cAAAC,EAAA,EACAC,UAAAH,EACAI,cAAAC,EAAA,EAEAC,kBAAA7E,EAAA,IClDA8E,GADiB1D,OAFjB,WAA0B,IAAaC,EAAbd,KAAae,eAA0BC,EAAvChB,KAAuCiB,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,SAAAA,EAAA,OAA6BiC,YAAA,yBAAmCjC,EAAA,OAAYiC,YAAA,iBAA2BjC,EAAA,UAAeK,OAAOmD,OAAA,KAAYxD,EAAA,UAAeK,OAAOC,KAAA,MAAWN,EAAA,WAAgBE,aAAaC,OAAA,QAAAsD,gBAAA,QAAwCpD,OAAQqD,MAAA,UAAgB1D,EAAA,+BAAtUhB,KAAsUmD,GAAA,KAAAnC,EAAA,UAA6DK,OAAOC,KAAA,MAAWN,EAAA,WAAgBE,aAAaC,OAAA,QAAAsD,gBAAA,QAAwCpD,OAAQqD,MAAA,UAAgB1D,EAAA,0BAAlfhB,KAAkfmD,GAAA,KAAAnC,EAAA,UAAwDK,OAAOmD,OAAA,KAAYxD,EAAA,UAAeK,OAAOC,KAAA,MAAWN,EAAA,WAAgBE,aAAaC,OAAA,SAAiBE,OAAQqD,MAAA,SAAe1D,EAAA,2BAAnqBhB,KAAmqBmD,GAAA,KAAAnC,EAAA,UAAyDK,OAAOC,KAAA,MAAWN,EAAA,WAAgBE,aAAaC,OAAA,SAAiBE,OAAQqD,MAAA,UAAgB1D,EAAA,mCAApzBhB,KAAozBmD,GAAA,KAAAnC,EAAA,OAA8DiC,YAAA,wBAAkCjC,EAAA,aAAkB2D,IAAIC,MAA16B5E,KAA06B6E,UAA16B7E,KAA87BmD,GAAA,iBAEv8B3B,oBCCjB,IAcAsD,EAdApD,EAAA,OAcAqD,CACAC,EACAT,GATA,EAVA,SAAA3C,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,QAAAiD,EAAA,oECpBAT,kFAOA,4EAMA3E,kEAGAC,iDAKAC,6DAIAqF,qBACAC,uBACApF,sCAGA,IAAAC,EAAAC,kCAGAC,8CAMAC,6BAGAC,kKAaAoC,sCACA4C,8CACA,GATAC,GAAA7C,EAAA8C,cAAA9C,EAAA+C,WAAA/C,EAWAI,gCACAC,OAAA,wCAGAC,mCAKAF,WAFA,IAAA4C,EAAA,IAIA,oBACAC,OAAA,wCACA,+CACA,sCACAC,IACArF,0BAEAC,qGAEAC,oHAMAA,4DAGA,wDACA,+CAMA,2BACA6B,QACA,uCAEA,iBAEAuD,oEAGA,gEAGA,eAEA,gBAEA,QACA,QACA,UACA,gBAEA,oBAEA,yBAIA,uBAEA,wBACA,YAEAC,uBAKA,wBAGA,aACA,4BAGA,WACA,gBACA,YAGA,oBAEAC,oBAEA,aACA,4BAGA,WACA,gBACA,YAGA,oBAIAC,sBCpKAC,GADiBjF,OAFjB,WAA0B,IAAaC,EAAbd,KAAae,eAAkD,OAA/Df,KAAuCiB,MAAAD,IAAAF,GAAwB,OAAiBO,OAAOE,GAAA,sBAEhGC,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACA0C,EACAyB,GATA,EAVA,SAAAlE,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,EAAAJ,EAAA,mICpBAyC,2GAaA,YAEA,mEAIAxE,kEAGAC,iDAKAC,6DAIAmG,qBACAd,qBACAC,uBACApF,sCAGA,IAAAC,EAAAC,kCAGAC,8CAMAC,6BAGAC,gDAGA,IAAA6F,EAAAhG,oBACA,sDAEAM,2JAcAiC,sCACA4C,8CACA,GATAC,GAAA7C,EAAA8C,cAAA9C,EAAA+C,WAAA/C,EAWAI,kCAEA,IAEA,IACA,IAEA,EACAC,OAAA,wCAGAC,aAGA,sBAEAF,0CAKAsD,6BAGAC,SAEA,oCAEA,WAGA,IACA,oBACAV,OAAA,wCACA,GACA,gDACA,sCACAC,IACArF,0BAEAC,qGAEAC,oHAMAA,aAGA6F,KACAZ,sDACA,sDACA,yDAMApD,QACA,uCAEA,iBAEAuD,oEAGA,kEAGA,YAEA,cAEA,QACA,QACA,UACA,gBAEA,oBAEA,yBAIA,uBAEA,wBACA,YAEAC,uBAGA,iBAGAS,0BAGA,UACA,4BAGA,WACA,gBACA,YAGA,oBAEAC,oBAEA,UACA,4BAGA,WACA,gBACA,YAGA,oBAEAC,sBAEA,UACA,4BAGA,WACA,gBACA,YAGA,oBAIAC,oBCvNAC,GADiB3F,OAFjB,WAA0B,IAAaC,EAAbd,KAAae,eAAkD,OAA/Df,KAAuCiB,MAAAD,IAAAF,GAAwB,OAAiBO,OAAOE,GAAA,sBAEhGC,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACAuC,EACAsC,GATA,EAVA,SAAA5E,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,EAAAJ,EAAA","file":"static/js/8.7fb6509ae531b5ff3dc6.js","sourcesContent":["<template>\r\n  <el-row style=\"height:100%;width:100%\">\r\n    <el-col :span=\"24\" style=\"height: 100%\">\r\n      <div id=\"task-type-pie\"></div>\r\n    </el-col>\r\n  </el-row>\r\n</template>\r\n\r\n<script>\r\nimport echarts from 'echarts'\r\nexport default {\r\n  data () {\r\n    return {\r\n      chart: {},\r\n      legendData: [],\r\n      todoData: [],\r\n      doingData: [],\r\n      doneData: []\r\n    }\r\n  },\r\n  computed: {\r\n    curSprint () {\r\n      return this.$store.state.sprint.curSprint\r\n    },\r\n    backlogList () {\r\n      return this.$store.state.sprint.backlogList\r\n    }\r\n  },\r\n  methods: {\r\n    initParam () {\r\n      this.onresizeDraw()\r\n    },\r\n    initData () {\r\n      if (this.curSprint.id) {\r\n        this.countType()\r\n        this.drawChart()\r\n      }\r\n    },\r\n    onresizeDraw () {\r\n      window.onresize = () => {\r\n        return (() => {\r\n          this.refresh()\r\n        })()\r\n      }\r\n    },\r\n    refresh () {\r\n      try {\r\n        this.chart.dispose()\r\n      } catch (error) {}\r\n      try {\r\n        this.initData()\r\n      } catch (error) {}\r\n    },\r\n    countType () {\r\n      this.legendData = []\r\n      this.todoData = []\r\n      this.doingData = []\r\n      this.doneData = []\r\n\r\n      let todo = []\r\n      let doing = []\r\n      let done = []\r\n      let tasks = []\r\n      let task = {}\r\n      for (let i = 0, len = this.backlogList.length; i < len; i++) {\r\n        tasks = this.backlogList[i].tasks\r\n        for (let j = 0, len = tasks.length; j < len; j++) {\r\n          task = tasks[j]\r\n          if (todo[task.type] >= 0) {\r\n            if (!task.startDate) {\r\n              todo[task.type] += task.estimate\r\n            } else if (task.startDate && !task.endDate) {\r\n              doing[task.type] += task.estimate\r\n            } else {\r\n              done[task.type] += task.estimate\r\n            }\r\n          } else {\r\n            todo[task.type] = 0\r\n            doing[task.type] = 0\r\n            done[task.type] = 0\r\n            if (!task.startDate) {\r\n              todo[task.type] = task.estimate\r\n            } else if (task.startDate && !task.endDate) {\r\n              doing[task.type] = task.estimate\r\n            } else {\r\n              done[task.type] = task.estimate\r\n            }\r\n          }\r\n        }\r\n      }\r\n      for (let key in todo) {\r\n        this.legendData.push(key)\r\n        this.todoData.push(todo[key])\r\n        this.doingData.push(doing[key])\r\n        this.doneData.push(done[key])\r\n      }\r\n    },\r\n    drawChart () {\r\n      this.chart = echarts.init(document.getElementById('task-type-pie'))\r\n      this.chart.setOption({\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          axisPointer: {\r\n            type: 'shadow'\r\n          }\r\n        },\r\n        legend: {\r\n          data: ['待认领', '进行中', '已完成'],\r\n          right: 10\r\n        },\r\n        grid: {\r\n          top: 40,\r\n          left: 0,\r\n          right: 10,\r\n          bottom: 0,\r\n          containLabel: true\r\n        },\r\n        xAxis: [{\r\n          type: 'category',\r\n          data: this.legendData\r\n        }],\r\n        yAxis: [{\r\n          type: 'value'\r\n        }],\r\n        series: [\r\n          {\r\n            name: '待认领',\r\n            type: 'bar',\r\n            stack: '1',\r\n            data: this.todoData\r\n          },\r\n          {\r\n            name: '进行中',\r\n            type: 'bar',\r\n            stack: '1',\r\n            data: this.doingData\r\n          },\r\n          {\r\n            name: '已完成',\r\n            type: 'bar',\r\n            stack: '1',\r\n            data: this.doneData\r\n          }\r\n        ]\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  #task-type-pie{\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modules/sprint/components/sprint-task-analyse.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('el-row',{staticStyle:{\"height\":\"100%\",\"width\":\"100%\"}},[_c('el-col',{staticStyle:{\"height\":\"100%\"},attrs:{\"span\":24}},[_c('div',{attrs:{\"id\":\"task-type-pie\"}})])],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-777fd434\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modules/sprint/components/sprint-task-analyse.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-777fd434\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./sprint-task-analyse.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./sprint-task-analyse.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./sprint-task-analyse.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-777fd434\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./sprint-task-analyse.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-777fd434\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/sprint/components/sprint-task-analyse.vue\n// module id = null\n// module chunks = ","<template>\r\n  <div class=\"user-chart-wrapper\">\r\n    <ul>\r\n      <li>\r\n        <span class=\"user-name-title\">姓名</span>\r\n        <span class=\"user-number-title\">认领</span>\r\n        <span class=\"user-number-title\">完成</span>\r\n        <span class=\"user-number-title\">延迟</span>\r\n        <span class=\"user-number-title\">生产率</span>\r\n        <span class=\"user-number-title\">投入系数</span>\r\n      </li>\r\n      <li v-for=\"userData in userDataList\" :key=\"userData.email\">\r\n        <img class=\"user-head\" :src=\"headUrl + userData.email\" alt=\"\">\r\n        <span class=\"user-name\">{{ userData.email | userFilter(userList) }}</span>\r\n        <span class=\"user-number\">{{ userData.claimTime }}</span>\r\n        <span class=\"user-number\">{{ userData.doneTime }}</span>\r\n        <span class=\"user-number\">{{ userData.delayTime }}</span>\r\n        <span class=\"user-number\">{{ userData.avgRate }}</span>\r\n        <span class=\"user-number\">{{ userData.rate }}</span>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data () {\r\n    return {\r\n      userDataList: [],\r\n      headUrl: ''\r\n    }\r\n  },\r\n  computed: {\r\n    curSprint () {\r\n      return this.$store.state.sprint.curSprint\r\n    },\r\n    backlogList () {\r\n      return this.$store.state.sprint.backlogList\r\n    },\r\n    userList () {\r\n      return this.$store.state.userList\r\n    }\r\n  },\r\n  methods: {\r\n    initParam () {\r\n      this.headUrl = this.$ccService.ccHeadUrl\r\n    },\r\n    initData () {\r\n      this.calcUserData()\r\n      this.calcUserAvgRate()\r\n    },\r\n    calcUserData () {\r\n      this.userDataList = this.$utils.deepCopy(this.curSprint.teams)\r\n      this.backlogList.forEach(backlog => {\r\n        backlog.tasks.forEach(item => {\r\n          this.userDataList.forEach(user => {\r\n            // 计算已认领工作量\r\n            if (user.email === item.userId) {\r\n              if (user.claimTime) {\r\n                user.claimTime += item.estimate\r\n              } else {\r\n                user.claimTime = item.estimate\r\n              }\r\n\r\n              // 计算延迟工作量\r\n              let delayDay = this.getWorkDayCount(item.startDate, item.endDate || new Date()) - item.estimate\r\n              if (delayDay > 0) {\r\n                if (user.delayTime) {\r\n                  user.delayTime += delayDay\r\n                } else {\r\n                  user.delayTime = delayDay\r\n                }\r\n              }\r\n            }\r\n\r\n            if (item.endDate && (user.email === item.userId)) {\r\n              // 计算累计完成工作量\r\n              if (user.doneTime) {\r\n                user.doneTime += item.estimate\r\n              } else {\r\n                user.doneTime = item.estimate\r\n              }\r\n            }\r\n          })\r\n        })\r\n      })\r\n    },\r\n    calcUserAvgRate () {\r\n      let misDay = this.getWorkDayCount(this.curSprint.startDate, new Date().getTime())\r\n      this.userDataList.forEach(user => {\r\n        user.avgRate = (user.doneTime / (misDay * user.rate)).toFixed(1)\r\n      })\r\n      this.userDataList.sort((a, b) => {\r\n        return (b.avgRate - a.avgRate) || (b.doneTime - a.doneTime)\r\n      })\r\n    },\r\n    getWorkDayCount (start, end) {\r\n      let [startDate, endDate] = [new Date(start), new Date(end)]\r\n      let workDayCount = 0\r\n      let misDay = Math.round((endDate.getTime() - startDate.getTime()) / 1000 / 60 / 60 / 24)\r\n      let [year, month, day] = [startDate.getFullYear(), startDate.getMonth(), startDate.getDate()]\r\n      let tmpDay, tmpDate\r\n\r\n      for (let i = 0; i <= misDay; i++) {\r\n        tmpDay = day + i\r\n        tmpDate = new Date(year, month, tmpDay)\r\n        // 不计算周末\r\n        if ((tmpDate.getDay() !== 0) && (tmpDate.getDay() !== 6)) {\r\n          workDayCount = workDayCount + 1\r\n        }\r\n      }\r\n      return workDayCount\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n  .el-table th{\r\n    padding: 10px 0 !important;\r\n  }\r\n</style>\r\n\r\n<style scoped lang=\"scss\">\r\n  .user-chart-wrapper{\r\n    height: 100%;\r\n    overflow-y: auto;\r\n\r\n    ul{\r\n      list-style: none;\r\n      margin: 0;\r\n      padding: 0 10px;\r\n\r\n      li{\r\n        display: flex;\r\n        align-items: center;\r\n        margin-bottom: 5px;\r\n      }\r\n\r\n      .user-name-title{\r\n        font-weight: bold;\r\n        margin-left: 34px;\r\n        font-size: 14px;\r\n        width: 60px;\r\n      }\r\n      .user-number-title{\r\n        font-weight: bold;\r\n        font-size: 14px;\r\n        width: 60px;\r\n      }\r\n\r\n      .user-name{\r\n        margin-left: 8px;\r\n        font-size: 14px;\r\n        width: 60px;\r\n      }\r\n      .user-number{\r\n        font-size: 14px;\r\n        width: 60px;\r\n      }\r\n    }\r\n  }\r\n  .user-head{\r\n    height: 26px;\r\n    width: 26px;\r\n    border-radius: 15px;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modules/sprint/components/user-chart.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"user-chart-wrapper\"},[_c('ul',[_vm._m(0),_vm._v(\" \"),_vm._l((_vm.userDataList),function(userData){return _c('li',{key:userData.email},[_c('img',{staticClass:\"user-head\",attrs:{\"src\":_vm.headUrl + userData.email,\"alt\":\"\"}}),_vm._v(\" \"),_c('span',{staticClass:\"user-name\"},[_vm._v(_vm._s(_vm._f(\"userFilter\")(userData.email,_vm.userList)))]),_vm._v(\" \"),_c('span',{staticClass:\"user-number\"},[_vm._v(_vm._s(userData.claimTime))]),_vm._v(\" \"),_c('span',{staticClass:\"user-number\"},[_vm._v(_vm._s(userData.doneTime))]),_vm._v(\" \"),_c('span',{staticClass:\"user-number\"},[_vm._v(_vm._s(userData.delayTime))]),_vm._v(\" \"),_c('span',{staticClass:\"user-number\"},[_vm._v(_vm._s(userData.avgRate))]),_vm._v(\" \"),_c('span',{staticClass:\"user-number\"},[_vm._v(_vm._s(userData.rate))])])})],2)])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('li',[_c('span',{staticClass:\"user-name-title\"},[_vm._v(\"姓名\")]),_vm._v(\" \"),_c('span',{staticClass:\"user-number-title\"},[_vm._v(\"认领\")]),_vm._v(\" \"),_c('span',{staticClass:\"user-number-title\"},[_vm._v(\"完成\")]),_vm._v(\" \"),_c('span',{staticClass:\"user-number-title\"},[_vm._v(\"延迟\")]),_vm._v(\" \"),_c('span',{staticClass:\"user-number-title\"},[_vm._v(\"生产率\")]),_vm._v(\" \"),_c('span',{staticClass:\"user-number-title\"},[_vm._v(\"投入系数\")])])}]\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-23b9ccb5\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modules/sprint/components/user-chart.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-23b9ccb5\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./user-chart.vue\")\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-23b9ccb5\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=1!./user-chart.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./user-chart.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./user-chart.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-23b9ccb5\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./user-chart.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-23b9ccb5\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/sprint/components/user-chart.vue\n// module id = null\n// module chunks = ","<template>\r\n  <panel>\r\n    <div class=\"sprint-chart-wrapper\">\r\n      <div class=\"sprint-chart\">\r\n        <el-row :gutter=\"8\">\r\n          <el-col :span=\"12\">\r\n            <ew-card title=\"统计数据\" style=\"height:300px;margin-bottom:10px\">\r\n              <sprint-task-analyse></sprint-task-analyse>\r\n            </ew-card>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <ew-card title=\"研发团队\" style=\"height:300px;margin-bottom:10px\">\r\n              <user-chart></user-chart>\r\n            </ew-card>\r\n          </el-col>\r\n        </el-row>\r\n        <el-row :gutter=\"8\">\r\n          <el-col :span=\"12\">\r\n            <ew-card title=\"燃尽图\" style=\"height:400px\">\r\n              <burn-down-chart></burn-down-chart>\r\n            </ew-card>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <ew-card title=\"团队效率\" style=\"height:400px\">\r\n              <team-rate-chart></team-rate-chart>\r\n            </ew-card>\r\n          </el-col>\r\n        </el-row>\r\n      </div>\r\n      <div class=\"sprint-chart-footer\">\r\n        <el-button @click=\"goBack\">关闭</el-button>\r\n      </div>\r\n    </div>\r\n  </panel>\r\n</template>\r\n\r\n<script>\r\nimport burnDownChart from '../components/burndown-chart'\r\nimport userChart from '../components/user-chart'\r\nimport teamRateChart from '../components/team-rate-chart'\r\nimport sprintTaskAnalyse from '../components/sprint-task-analyse'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n    }\r\n  },\r\n  components: {\r\n    burnDownChart,\r\n    userChart,\r\n    teamRateChart,\r\n    sprintTaskAnalyse\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .sprint-chart-wrapper{\r\n    height: 100%;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n\r\n    .sprint-chart{\r\n      flex: 1 1 200px;\r\n      overflow-y: auto;\r\n      overflow-x: hidden;\r\n    }\r\n\r\n    .sprint-chart-footer{\r\n      flex: 0 0 50px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: flex-end;\r\n    }\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modules/sprint/pages/SprintChart.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('panel',[_c('div',{staticClass:\"sprint-chart-wrapper\"},[_c('div',{staticClass:\"sprint-chart\"},[_c('el-row',{attrs:{\"gutter\":8}},[_c('el-col',{attrs:{\"span\":12}},[_c('ew-card',{staticStyle:{\"height\":\"300px\",\"margin-bottom\":\"10px\"},attrs:{\"title\":\"统计数据\"}},[_c('sprint-task-analyse')],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":12}},[_c('ew-card',{staticStyle:{\"height\":\"300px\",\"margin-bottom\":\"10px\"},attrs:{\"title\":\"研发团队\"}},[_c('user-chart')],1)],1)],1),_vm._v(\" \"),_c('el-row',{attrs:{\"gutter\":8}},[_c('el-col',{attrs:{\"span\":12}},[_c('ew-card',{staticStyle:{\"height\":\"400px\"},attrs:{\"title\":\"燃尽图\"}},[_c('burn-down-chart')],1)],1),_vm._v(\" \"),_c('el-col',{attrs:{\"span\":12}},[_c('ew-card',{staticStyle:{\"height\":\"400px\"},attrs:{\"title\":\"团队效率\"}},[_c('team-rate-chart')],1)],1)],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"sprint-chart-footer\"},[_c('el-button',{on:{\"click\":_vm.goBack}},[_vm._v(\"关闭\")])],1)])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-17185839\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modules/sprint/pages/SprintChart.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-17185839\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./SprintChart.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./SprintChart.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./SprintChart.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-17185839\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./SprintChart.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-17185839\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/sprint/pages/SprintChart.vue\n// module id = null\n// module chunks = ","<template>\r\n  <div id=\"team-rate-chart\"></div>\r\n</template>\r\n\r\n<script>\r\nimport echarts from 'echarts'\r\nexport default {\r\n  data () {\r\n    return {\r\n      dateList: [],\r\n      taskRateList: [],\r\n      sprintRateList: [],\r\n      rateOfDay: 0,\r\n      chart: {}\r\n    }\r\n  },\r\n  computed: {\r\n    curSprint () {\r\n      return this.$store.state.sprint.curSprint\r\n    },\r\n    backlogList () {\r\n      return this.$store.state.sprint.backlogList\r\n    }\r\n  },\r\n  methods: {\r\n    initParam () {\r\n      this.onresizeDraw()\r\n    },\r\n    initData () {\r\n      if (this.curSprint.id) {\r\n        this.calcRateOfDay()\r\n        this.calcDateAndTime()\r\n        this.drawChart()\r\n      }\r\n    },\r\n    onresizeDraw () {\r\n      window.onresize = () => {\r\n        return (() => {\r\n          this.refresh()\r\n        })()\r\n      }\r\n    },\r\n    refresh () {\r\n      try {\r\n        this.chart.dispose()\r\n      } catch (error) {}\r\n      try {\r\n        this.initData()\r\n      } catch (error) {}\r\n    },\r\n    /**\r\n     * 计算迭代周期和每日进度\r\n     */\r\n    calcDateAndTime () {\r\n      this.sprintRateList = []\r\n      this.taskRateList = []\r\n      this.dateList = []\r\n      this.rateList = []\r\n\r\n      // 项目开始、结束时间\r\n      let startDate = new Date(this.curSprint.startDate)\r\n      let endDate = new Date(this.curSprint.publishDate)\r\n      let misDay = (endDate.getTime() - startDate.getTime()) / 1000 / 60 / 60 / 24\r\n      let [year, month, day] = [startDate.getFullYear(), startDate.getMonth(), startDate.getDate()]\r\n\r\n      let tmpDate\r\n      let tmpDay = 0\r\n      for (let i = 0; i <= misDay; i++) {\r\n        tmpDay = day + i\r\n        tmpDate = new Date(year, month, tmpDay)\r\n        // 排除周日\r\n        if (tmpDate.getDay() !== 0) {\r\n          this.dateList.push(tmpDate.getDate())\r\n\r\n          // 生产率\r\n          let [testDayTotal, dayTotal] = [0, 0]\r\n          let tasks, task, backlog\r\n          if ((new Date().getTime() - tmpDate.getTime()) > 0) {\r\n            for (let i = 0, len = this.backlogList.length; i < len; i++) {\r\n              backlog = this.backlogList[i]\r\n              tasks = backlog.tasks\r\n              for (let j = 0, len = tasks.length; j < len; j++) {\r\n                task = tasks[j]\r\n                if ((new Date(task.endDate).getMonth() === tmpDate.getMonth()) && (new Date(task.endDate).getDate() === tmpDate.getDate())) {\r\n                  dayTotal += task.estimate\r\n                }\r\n              }\r\n\r\n              // 测试\r\n              if ((new Date(backlog.endTestDate).getMonth() === tmpDate.getMonth()) && (new Date(backlog.endTestDate).getDate() === tmpDate.getDate())) {\r\n                testDayTotal += task.estimate\r\n              }\r\n            }\r\n            this.taskRateList.push((dayTotal / this.rateOfDay).toFixed(1))\r\n            this.sprintRateList.push((testDayTotal / this.rateOfDay).toFixed(1))\r\n          }\r\n        }\r\n      }\r\n    },\r\n    calcRateOfDay () {\r\n      this.rateOfDay = 0\r\n      let team = this.curSprint.teams\r\n      let count = 0\r\n      for (let i = 0, len = team.length; i < len; i++) {\r\n        count += team[i].rate || 1\r\n      }\r\n      this.rateOfDay = count\r\n    },\r\n    drawChart () {\r\n      this.chart = echarts.init(document.getElementById('team-rate-chart'))\r\n      this.chart.setOption({\r\n        legend: {\r\n          data: ['任务生产率', '故事生产率'],\r\n          right: '4%'\r\n        },\r\n        grid: {\r\n          top: 40,\r\n          left: 0,\r\n          right: 10,\r\n          bottom: 0,\r\n          containLabel: true\r\n        },\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          axisPointer: {\r\n            type: 'shadow'\r\n          }\r\n        },\r\n        xAxis: {\r\n          type: 'category',\r\n          boundaryGap: false,\r\n          data: this.dateList\r\n        },\r\n        yAxis: [\r\n          {\r\n            type: 'value'\r\n          }\r\n        ],\r\n        series: [\r\n          {\r\n            name: '任务生产率',\r\n            type: 'line',\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                position: 'top',\r\n                formatter: '{c}',\r\n                color: 'black'\r\n              }\r\n            },\r\n            data: this.taskRateList\r\n          },\r\n          {\r\n            name: '故事生产率',\r\n            type: 'line',\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                position: 'top',\r\n                formatter: '{c}',\r\n                color: 'black'\r\n              }\r\n            },\r\n            data: this.sprintRateList\r\n          }\r\n        ]\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  #team-rate-chart{\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modules/sprint/components/team-rate-chart.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"team-rate-chart\"}})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-bac39264\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modules/sprint/components/team-rate-chart.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-bac39264\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./team-rate-chart.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./team-rate-chart.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./team-rate-chart.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-bac39264\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./team-rate-chart.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-bac39264\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/sprint/components/team-rate-chart.vue\n// module id = null\n// module chunks = ","<template>\r\n  <div id=\"burn-down-chart\"></div>\r\n</template>\r\n\r\n<script>\r\nimport echarts from 'echarts'\r\nexport default {\r\n  data () {\r\n    return {\r\n      chart: {},\r\n      // x轴\r\n      dateList: [],\r\n      // 计划线\r\n      planDataList: [],\r\n      // 实际线(任务维度)\r\n      actualDataList: [],\r\n      // 功能测试线\r\n      testDataList: [],\r\n      totalTime: 0,\r\n      rateOfDay: 0\r\n    }\r\n  },\r\n  computed: {\r\n    curSprint () {\r\n      return this.$store.state.sprint.curSprint\r\n    },\r\n    backlogList () {\r\n      return this.$store.state.sprint.backlogList\r\n    }\r\n  },\r\n  methods: {\r\n    initParam () {\r\n      this.onresizeDraw()\r\n    },\r\n    initData () {\r\n      if (this.curSprint.id) {\r\n        this.calcTotalTime()\r\n        this.calcRateOfDay()\r\n        this.calcDateAndTime()\r\n        this.drawChart()\r\n      }\r\n    },\r\n    onresizeDraw () {\r\n      window.onresize = () => {\r\n        return (() => {\r\n          this.refresh()\r\n        })()\r\n      }\r\n    },\r\n    refresh () {\r\n      try {\r\n        this.chart.dispose()\r\n      } catch (error) {}\r\n      try {\r\n        this.initData()\r\n      } catch (error) {}\r\n    },\r\n    calcTotalTime () {\r\n      this.totalTime = 0\r\n      this.backlogList.forEach((item) => {\r\n        this.totalTime += item.estimate\r\n      })\r\n    },\r\n\r\n    /**\r\n     * 计算迭代周期和每日进度\r\n     */\r\n    calcDateAndTime () {\r\n      this.dateList = []\r\n      this.planDataList = []\r\n      this.actualDataList = []\r\n      this.testDataList = []\r\n\r\n      // 项目开始、结束时间\r\n      let startDate = new Date(this.curSprint.startDate)\r\n      let endDate = new Date(this.curSprint.publishDate)\r\n      let misDay = (endDate.getTime() - startDate.getTime()) / 1000 / 60 / 60 / 24\r\n      let [year, month, day] = [startDate.getFullYear(), startDate.getMonth(), startDate.getDate()]\r\n\r\n      // 标准累计完成故事点\r\n      let planTotal = 0\r\n      // 标准剩余故事点\r\n      let planLeftTotal = 1\r\n      let total = 0\r\n      let testTotal = 0\r\n\r\n      let tmpDate\r\n      let tmpDay = 0\r\n      for (let i = 0; i <= misDay; i++) {\r\n        tmpDay = day + i\r\n        tmpDate = new Date(year, month, tmpDay)\r\n        // 排除周日\r\n        if (tmpDate.getDay() !== 0) {\r\n          this.dateList.push(tmpDate.getDate())\r\n\r\n          // 计算标准每日完成故事点\r\n          if (planLeftTotal > 0) {\r\n            // 标准不计算周六\r\n            if (tmpDate.getDay() !== 6) {\r\n              planTotal += this.rateOfDay\r\n            }\r\n\r\n            planLeftTotal = this.totalTime - planTotal\r\n            if (planLeftTotal < 0) {\r\n              planLeftTotal = 0\r\n            }\r\n            this.planDataList.push(planLeftTotal.toFixed(1))\r\n          }\r\n\r\n          let dayTotal = 0\r\n          let testDayTotal = 0\r\n          let tasks, task, backlog\r\n          if ((new Date().getTime() - tmpDate.getTime()) > 0) {\r\n            dayTotal = 0\r\n            for (let i = 0, len = this.backlogList.length; i < len; i++) {\r\n              backlog = this.backlogList[i]\r\n              tasks = backlog.tasks\r\n              for (let j = 0, len = tasks.length; j < len; j++) {\r\n                task = tasks[j]\r\n                if ((new Date(task.endDate).getMonth() === tmpDate.getMonth()) && (new Date(task.endDate).getDate() === tmpDate.getDate())) {\r\n                  dayTotal += task.estimate\r\n                }\r\n              }\r\n\r\n              // 测试\r\n              if ((new Date(backlog.endTestDate).getMonth() === tmpDate.getMonth()) && (new Date(backlog.endTestDate).getDate() === tmpDate.getDate())) {\r\n                testDayTotal += backlog.estimate\r\n              }\r\n            }\r\n            total = total + dayTotal\r\n            testTotal = testTotal + testDayTotal\r\n            this.actualDataList.push((this.totalTime - total).toFixed(1))\r\n            this.testDataList.push((this.totalTime - testTotal).toFixed(1))\r\n          }\r\n        }\r\n      }\r\n    },\r\n    calcRateOfDay () {\r\n      let team = this.curSprint.teams\r\n      let count = 0\r\n      for (let i = 0, len = team.length; i < len; i++) {\r\n        count += team[i].rate || 1\r\n      }\r\n      this.rateOfDay = count\r\n    },\r\n    drawChart () {\r\n      this.chart = echarts.init(document.getElementById('burn-down-chart'))\r\n      this.chart.setOption({\r\n        legend: {\r\n          data: ['标准', '实际', '测试'],\r\n          right: 10\r\n        },\r\n        grid: {\r\n          top: 40,\r\n          left: 0,\r\n          right: 10,\r\n          bottom: 0,\r\n          containLabel: true\r\n        },\r\n        tooltip: {\r\n          trigger: 'axis',\r\n          axisPointer: {\r\n            type: 'shadow'\r\n          }\r\n        },\r\n        xAxis: {\r\n          type: 'category',\r\n          boundaryGap: false,\r\n          data: this.dateList\r\n        },\r\n        yAxis: [\r\n          {\r\n            type: 'value',\r\n            max: this.totalTime\r\n          }\r\n        ],\r\n        series: [\r\n          {\r\n            name: '标准',\r\n            type: 'line',\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                position: 'top',\r\n                formatter: '{c}',\r\n                color: 'black'\r\n              }\r\n            },\r\n            data: this.planDataList\r\n          },\r\n          {\r\n            name: '实际',\r\n            type: 'line',\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                position: 'top',\r\n                formatter: '{c}',\r\n                color: 'black'\r\n              }\r\n            },\r\n            data: this.actualDataList\r\n          },\r\n          {\r\n            name: '测试',\r\n            type: 'line',\r\n            label: {\r\n              normal: {\r\n                show: true,\r\n                position: 'top',\r\n                formatter: '{c}',\r\n                color: 'black'\r\n              }\r\n            },\r\n            data: this.testDataList\r\n          }\r\n        ]\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  #burn-down-chart{\r\n    height: 100%;\r\n    width: 100%;\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modules/sprint/components/burndown-chart.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"burn-down-chart\"}})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-28d754e0\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modules/sprint/components/burndown-chart.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-28d754e0\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./burndown-chart.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./burndown-chart.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./burndown-chart.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-28d754e0\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./burndown-chart.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-28d754e0\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/sprint/components/burndown-chart.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}