webpackJsonp([15],{ASWK:function(e,t){},ZKfk:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("//Fk"),r=i.n(o),n={data:function(){return{defaultProps:{children:"children",label:"name",id:"id"},props:{value:"id",label:"name"},roleList:[],roleId:1,roleForm:{},roleParent:[],menuList:[],infoSetting:!1,roleMenuList:[],menuCheck:[],roleSwitching:!1}},computed:{roleTreeData:function(){return this.$utils.arrayToTree(this.roleList)},menuTreeData:function(){return this.$utils.arrayToTree(this.menuList)}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;this.findAllRole().then(function(t){return e.roleList=t,e.newRoleForm(),e.findAllMenu()}).then(function(t){e.menuList=t})},menuSelect:function(e,t,i){this.roleForm._id&&(this.roleSwitching||(t?this.saveRoleMenu(e.id):this.deleteRoleMenu(e.id)))},saveRoleMenu:function(e){var t=this,i={roleId:this.roleForm.id,menuId:e};this.findRoleMenu(e)||this.$dataService.save(this.$apiUrl.SYS_SAVE_ROLEMENU,i).then(function(e){t.roleMenuList.push(e)})},findRoleMenu:function(e){for(var t=0,i=this.roleMenuList.length;t<i;t++){var o=this.roleMenuList[t];if(o.roleId===this.roleForm.id&&o.menuId===e)return o}return null},deleteRoleMenu:function(e){var t=this,i=this.findRoleMenu(e);this.$dataService.deleteById(this.$apiUrl.SYS_DELETE_ROLEMENU+i._id).then(function(){t.roleMenuList=t.roleMenuList.filter(function(t){return t.menuId!==e})})},setting:function(){var e=this;this.infoSetting=!0,setTimeout(function(){e.infoSetting=!1},1e3)},getMaxRoleId:function(){for(var e=0,t=0,i=this.roleList.length;t<i;t++)this.roleList[t].id>e&&(e=this.roleList[t].id);return e+1},newRoleForm:function(){this.roleForm={id:this.getMaxRoleId(),pid:null,name:"",sort:0,state:0,children:[]}},getRoleMenuList:function(e){var t={roleId:e};return this.$dataService.find(this.$apiUrl.SYS_FIND_ROLEMENU,t)},onUpdateRole:function(){var e=this;this.roleForm.pid=this.roleParent&&this.roleParent.slice(0).pop(),this.$dataService.update(this.$apiUrl.SYS_UPDATE_ROLE+this.roleForm._id,this.roleForm).then(function(t){e.updateRolePid()})},updateRolePid:function(){var e=this;this.roleList.forEach(function(t){t.id===e.roleForm.id&&(t.pid=e.roleForm.pid)})},onDeleteRole:function(){var e=this;this.deleteConfirm().then(function(){e.deleteRole()}).catch(function(){e.$notify({title:"警告",message:"不能删除非底层角色",type:"warning"})})},deleteRole:function(){var e=this;this.$dataService.deleteById(this.$apiUrl.SYS_DELETE_ROLE+this.roleForm._id).then(function(t){e.roleList=e.roleList.filter(function(t){return t.id!==e.roleForm.id}),e.roleForm={},e.roleParent=[]})},deleteConfirm:function(){var e=this;return new r.a(function(t,i){e.roleList.some(function(t){return t.pid===e.roleForm.id})?i(new Error):t()})},onAddRole:function(){this.newRoleForm()},onSaveRole:function(){var e=this;this.roleForm.pid=this.roleParent&&this.roleParent.slice(0).pop(),this.$utils.appendTreeNode(this.roleTreeData,this.$utils.merge({},this.roleForm)),this.$dataService.save(this.$apiUrl.SYS_SAVE_ROLE,this.roleForm).then(function(t){e.roleList.push(t),e.newRoleForm()})},nodeClick:function(e){var t=this;this.roleForm=e,this.roleParent=e.pid&&this.$utils.getCascadeValue(this.roleList,e.pid),this.getRoleMenuList(this.roleForm.id).then(function(e){t.roleMenuList=e,t.setMenuCheck()})},setMenuCheck:function(){var e=this;this.roleSwitching=!0,this.menuCheck=[];for(var t=0,i=this.roleMenuList.length;t<i;t++)this.menuCheck.push(this.roleMenuList[t].menuId);this.$refs.menuTree.setCheckedKeys(this.menuCheck),setTimeout(function(){e.roleSwitching=!1},1e3)}}},l={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("panel",[i("div",{staticClass:"role-wrapper"},[i("div",{staticClass:"role-content"},[i("el-card",{staticClass:"role-tree"},[i("el-button",{staticClass:"add-role-btn",attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.onAddRole}},[e._v("新增")]),e._v(" "),i("el-tree",{attrs:{data:e.roleTreeData,"show-checkbox":"","default-expand-all":!0,"expand-on-click-node":!1,"highlight-current":"",clearable:"","node-key":"id",props:e.defaultProps},on:{"node-click":e.nodeClick}})],1),e._v(" "),i("el-card",{staticClass:"box-card"},[i("el-form",{ref:"form",attrs:{model:e.roleForm,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"父级"}},[i("el-cascader",{staticStyle:{width:"100%"},attrs:{options:e.roleTreeData,"change-on-select":"",clearable:"",props:e.props},model:{value:e.roleParent,callback:function(t){e.roleParent=t},expression:"roleParent"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"名称"}},[i("el-input",{attrs:{"auto-complete":"off"},model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name",t)},expression:"roleForm.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"是否启用"}},[i("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ddd","active-value":1,"inactive-value":0},model:{value:e.roleForm.state,callback:function(t){e.$set(e.roleForm,"state",t)},expression:"roleForm.state"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"排序"}},[i("el-input-number",{model:{value:e.roleForm.sort,callback:function(t){e.$set(e.roleForm,"sort",t)},expression:"roleForm.sort"}})],1),e._v(" "),i("el-form-item",[e.roleForm._id?i("div",[i("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-edit"},on:{click:e.onUpdateRole}},[e._v("修改")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"success",icon:"setting"},on:{click:e.setting}},[e._v("配置资源")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete"},on:{click:e.onDeleteRole}},[e._v("删除")])],1):i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onSaveRole}},[e._v("新增")])],1)],1)],1),e._v(" "),i("el-card",{staticClass:"role-tree",class:{"wave-animation":e.infoSetting}},[i("el-tree",{ref:"menuTree",attrs:{data:e.menuTreeData,"show-checkbox":"","check-strictly":!0,"default-expand-all":!0,"highlight-current":"",clearable:"","node-key":"id",props:e.defaultProps},on:{"check-change":e.menuSelect}})],1)],1)])])},staticRenderFns:[]};var s=i("VU/8")(n,l,!1,function(e){i("jvqL"),i("ASWK")},"data-v-8867912a",null);t.default=s.exports},jvqL:function(e,t){}});
//# sourceMappingURL=15.be0f1482e9f87a2ea63c.js.map