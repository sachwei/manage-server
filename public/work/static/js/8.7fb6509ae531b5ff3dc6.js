webpackJsonp([8],{"2WVf":function(t,e,a){"use strict";var i=a("XLwt"),s=a.n(i),n={data:function(){return{chart:{},legendData:[],todoData:[],doingData:[],doneData:[]}},computed:{curSprint:function(){return this.$store.state.sprint.curSprint},backlogList:function(){return this.$store.state.sprint.backlogList}},methods:{initParam:function(){this.onresizeDraw()},initData:function(){this.curSprint.id&&(this.countType(),this.drawChart())},onresizeDraw:function(){var t=this;window.onresize=function(){t.refresh()}},refresh:function(){try{this.chart.dispose()}catch(t){}try{this.initData()}catch(t){}},countType:function(){this.legendData=[],this.todoData=[],this.doingData=[],this.doneData=[];for(var t=[],e=[],a=[],i=[],s={},n=0,r=this.backlogList.length;n<r;n++)for(var o=0,c=(i=this.backlogList[n].tasks).length;o<c;o++)t[(s=i[o]).type]>=0?s.startDate?s.startDate&&!s.endDate?e[s.type]+=s.estimate:a[s.type]+=s.estimate:t[s.type]+=s.estimate:(t[s.type]=0,e[s.type]=0,a[s.type]=0,s.startDate?s.startDate&&!s.endDate?e[s.type]=s.estimate:a[s.type]=s.estimate:t[s.type]=s.estimate);for(var h in t)this.legendData.push(h),this.todoData.push(t[h]),this.doingData.push(e[h]),this.doneData.push(a[h])},drawChart:function(){this.chart=s.a.init(document.getElementById("task-type-pie")),this.chart.setOption({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["待认领","进行中","已完成"],right:10},grid:{top:40,left:0,right:10,bottom:0,containLabel:!0},xAxis:[{type:"category",data:this.legendData}],yAxis:[{type:"value"}],series:[{name:"待认领",type:"bar",stack:"1",data:this.todoData},{name:"进行中",type:"bar",stack:"1",data:this.doingData},{name:"已完成",type:"bar",stack:"1",data:this.doneData}]})}}},r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("el-row",{staticStyle:{height:"100%",width:"100%"}},[e("el-col",{staticStyle:{height:"100%"},attrs:{span:24}},[e("div",{attrs:{id:"task-type-pie"}})])],1)},staticRenderFns:[]};var o=a("VU/8")(n,r,!1,function(t){a("6Jkr")},"data-v-777fd434",null);e.a=o.exports},"6Jkr":function(t,e){},"8wen":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("cHCn"),s={data:function(){return{userDataList:[],headUrl:""}},computed:{curSprint:function(){return this.$store.state.sprint.curSprint},backlogList:function(){return this.$store.state.sprint.backlogList},userList:function(){return this.$store.state.userList}},methods:{initParam:function(){this.headUrl=this.$ccService.ccHeadUrl},initData:function(){this.calcUserData(),this.calcUserAvgRate()},calcUserData:function(){var t=this;this.userDataList=this.$utils.deepCopy(this.curSprint.teams),this.backlogList.forEach(function(e){e.tasks.forEach(function(e){t.userDataList.forEach(function(a){if(a.email===e.userId){a.claimTime?a.claimTime+=e.estimate:a.claimTime=e.estimate;var i=t.getWorkDayCount(e.startDate,e.endDate||new Date)-e.estimate;i>0&&(a.delayTime?a.delayTime+=i:a.delayTime=i)}e.endDate&&a.email===e.userId&&(a.doneTime?a.doneTime+=e.estimate:a.doneTime=e.estimate)})})})},calcUserAvgRate:function(){var t=this.getWorkDayCount(this.curSprint.startDate,(new Date).getTime());this.userDataList.forEach(function(e){e.avgRate=(e.doneTime/(t*e.rate)).toFixed(1)}),this.userDataList.sort(function(t,e){return e.avgRate-t.avgRate||e.doneTime-t.doneTime})},getWorkDayCount:function(t,e){for(var a=new Date(t),i=new Date(e),s=0,n=Math.round((i.getTime()-a.getTime())/1e3/60/60/24),r=[a.getFullYear(),a.getMonth(),a.getDate()],o=r[0],c=r[1],h=r[2],l=void 0,u=0;u<=n;u++)0!==(l=new Date(o,c,h+u)).getDay()&&6!==l.getDay()&&(s+=1);return s}}},n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-chart-wrapper"},[a("ul",[t._m(0),t._v(" "),t._l(t.userDataList,function(e){return a("li",{key:e.email},[a("img",{staticClass:"user-head",attrs:{src:t.headUrl+e.email,alt:""}}),t._v(" "),a("span",{staticClass:"user-name"},[t._v(t._s(t._f("userFilter")(e.email,t.userList)))]),t._v(" "),a("span",{staticClass:"user-number"},[t._v(t._s(e.claimTime))]),t._v(" "),a("span",{staticClass:"user-number"},[t._v(t._s(e.doneTime))]),t._v(" "),a("span",{staticClass:"user-number"},[t._v(t._s(e.delayTime))]),t._v(" "),a("span",{staticClass:"user-number"},[t._v(t._s(e.avgRate))]),t._v(" "),a("span",{staticClass:"user-number"},[t._v(t._s(e.rate))])])})],2)])},staticRenderFns:[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",[a("span",{staticClass:"user-name-title"},[t._v("姓名")]),t._v(" "),a("span",{staticClass:"user-number-title"},[t._v("认领")]),t._v(" "),a("span",{staticClass:"user-number-title"},[t._v("完成")]),t._v(" "),a("span",{staticClass:"user-number-title"},[t._v("延迟")]),t._v(" "),a("span",{staticClass:"user-number-title"},[t._v("生产率")]),t._v(" "),a("span",{staticClass:"user-number-title"},[t._v("投入系数")])])}]};var r=a("VU/8")(s,n,!1,function(t){a("e2nN"),a("yVxk")},"data-v-23b9ccb5",null).exports,o=a("E5a8"),c=a("2WVf"),h={data:function(){return{}},components:{burnDownChart:i.a,userChart:r,teamRateChart:o.a,sprintTaskAnalyse:c.a}},l={render:function(){var t=this.$createElement,e=this._self._c||t;return e("panel",[e("div",{staticClass:"sprint-chart-wrapper"},[e("div",{staticClass:"sprint-chart"},[e("el-row",{attrs:{gutter:8}},[e("el-col",{attrs:{span:12}},[e("ew-card",{staticStyle:{height:"300px","margin-bottom":"10px"},attrs:{title:"统计数据"}},[e("sprint-task-analyse")],1)],1),this._v(" "),e("el-col",{attrs:{span:12}},[e("ew-card",{staticStyle:{height:"300px","margin-bottom":"10px"},attrs:{title:"研发团队"}},[e("user-chart")],1)],1)],1),this._v(" "),e("el-row",{attrs:{gutter:8}},[e("el-col",{attrs:{span:12}},[e("ew-card",{staticStyle:{height:"400px"},attrs:{title:"燃尽图"}},[e("burn-down-chart")],1)],1),this._v(" "),e("el-col",{attrs:{span:12}},[e("ew-card",{staticStyle:{height:"400px"},attrs:{title:"团队效率"}},[e("team-rate-chart")],1)],1)],1)],1),this._v(" "),e("div",{staticClass:"sprint-chart-footer"},[e("el-button",{on:{click:this.goBack}},[this._v("关闭")])],1)])])},staticRenderFns:[]};var u=a("VU/8")(h,l,!1,function(t){a("TDQR")},"data-v-17185839",null);e.default=u.exports},E5a8:function(t,e,a){"use strict";var i=a("XLwt"),s=a.n(i),n={data:function(){return{dateList:[],taskRateList:[],sprintRateList:[],rateOfDay:0,chart:{}}},computed:{curSprint:function(){return this.$store.state.sprint.curSprint},backlogList:function(){return this.$store.state.sprint.backlogList}},methods:{initParam:function(){this.onresizeDraw()},initData:function(){this.curSprint.id&&(this.calcRateOfDay(),this.calcDateAndTime(),this.drawChart())},onresizeDraw:function(){var t=this;window.onresize=function(){t.refresh()}},refresh:function(){try{this.chart.dispose()}catch(t){}try{this.initData()}catch(t){}},calcDateAndTime:function(){this.sprintRateList=[],this.taskRateList=[],this.dateList=[],this.rateList=[];for(var t=new Date(this.curSprint.startDate),e=(new Date(this.curSprint.publishDate).getTime()-t.getTime())/1e3/60/60/24,a=[t.getFullYear(),t.getMonth(),t.getDate()],i=a[0],s=a[1],n=a[2],r=void 0,o=0;o<=e;o++)if(0!==(r=new Date(i,s,n+o)).getDay()){this.dateList.push(r.getDate());var c=0,h=0,l=void 0,u=void 0,d=void 0;if((new Date).getTime()-r.getTime()>0){for(var p=0,m=this.backlogList.length;p<m;p++){for(var f=0,D=(l=(d=this.backlogList[p]).tasks).length;f<D;f++)u=l[f],new Date(u.endDate).getMonth()===r.getMonth()&&new Date(u.endDate).getDate()===r.getDate()&&(h+=u.estimate);new Date(d.endTestDate).getMonth()===r.getMonth()&&new Date(d.endTestDate).getDate()===r.getDate()&&(c+=u.estimate)}this.taskRateList.push((h/this.rateOfDay).toFixed(1)),this.sprintRateList.push((c/this.rateOfDay).toFixed(1))}}},calcRateOfDay:function(){this.rateOfDay=0;for(var t=this.curSprint.teams,e=0,a=0,i=t.length;a<i;a++)e+=t[a].rate||1;this.rateOfDay=e},drawChart:function(){this.chart=s.a.init(document.getElementById("team-rate-chart")),this.chart.setOption({legend:{data:["任务生产率","故事生产率"],right:"4%"},grid:{top:40,left:0,right:10,bottom:0,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",boundaryGap:!1,data:this.dateList},yAxis:[{type:"value"}],series:[{name:"任务生产率",type:"line",label:{normal:{show:!0,position:"top",formatter:"{c}",color:"black"}},data:this.taskRateList},{name:"故事生产率",type:"line",label:{normal:{show:!0,position:"top",formatter:"{c}",color:"black"}},data:this.sprintRateList}]})}}},r={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"team-rate-chart"}})},staticRenderFns:[]};var o=a("VU/8")(n,r,!1,function(t){a("SutS")},"data-v-bac39264",null);e.a=o.exports},QGcI:function(t,e){},SutS:function(t,e){},TDQR:function(t,e){},cHCn:function(t,e,a){"use strict";var i=a("XLwt"),s=a.n(i),n={data:function(){return{chart:{},dateList:[],planDataList:[],actualDataList:[],testDataList:[],totalTime:0,rateOfDay:0}},computed:{curSprint:function(){return this.$store.state.sprint.curSprint},backlogList:function(){return this.$store.state.sprint.backlogList}},methods:{initParam:function(){this.onresizeDraw()},initData:function(){this.curSprint.id&&(this.calcTotalTime(),this.calcRateOfDay(),this.calcDateAndTime(),this.drawChart())},onresizeDraw:function(){var t=this;window.onresize=function(){t.refresh()}},refresh:function(){try{this.chart.dispose()}catch(t){}try{this.initData()}catch(t){}},calcTotalTime:function(){var t=this;this.totalTime=0,this.backlogList.forEach(function(e){t.totalTime+=e.estimate})},calcDateAndTime:function(){this.dateList=[],this.planDataList=[],this.actualDataList=[],this.testDataList=[];for(var t=new Date(this.curSprint.startDate),e=(new Date(this.curSprint.publishDate).getTime()-t.getTime())/1e3/60/60/24,a=[t.getFullYear(),t.getMonth(),t.getDate()],i=a[0],s=a[1],n=a[2],r=0,o=1,c=0,h=0,l=void 0,u=0;u<=e;u++)if(0!==(l=new Date(i,s,n+u)).getDay()){this.dateList.push(l.getDate()),o>0&&(6!==l.getDay()&&(r+=this.rateOfDay),(o=this.totalTime-r)<0&&(o=0),this.planDataList.push(o.toFixed(1)));var d=0,p=0,m=void 0,f=void 0,D=void 0;if((new Date).getTime()-l.getTime()>0){d=0;for(var g=0,v=this.backlogList.length;g<v;g++){for(var y=0,w=(m=(D=this.backlogList[g]).tasks).length;y<w;y++)f=m[y],new Date(f.endDate).getMonth()===l.getMonth()&&new Date(f.endDate).getDate()===l.getDate()&&(d+=f.estimate);new Date(D.endTestDate).getMonth()===l.getMonth()&&new Date(D.endTestDate).getDate()===l.getDate()&&(p+=D.estimate)}c+=d,h+=p,this.actualDataList.push((this.totalTime-c).toFixed(1)),this.testDataList.push((this.totalTime-h).toFixed(1))}}},calcRateOfDay:function(){for(var t=this.curSprint.teams,e=0,a=0,i=t.length;a<i;a++)e+=t[a].rate||1;this.rateOfDay=e},drawChart:function(){this.chart=s.a.init(document.getElementById("burn-down-chart")),this.chart.setOption({legend:{data:["标准","实际","测试"],right:10},grid:{top:40,left:0,right:10,bottom:0,containLabel:!0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",boundaryGap:!1,data:this.dateList},yAxis:[{type:"value",max:this.totalTime}],series:[{name:"标准",type:"line",label:{normal:{show:!0,position:"top",formatter:"{c}",color:"black"}},data:this.planDataList},{name:"实际",type:"line",label:{normal:{show:!0,position:"top",formatter:"{c}",color:"black"}},data:this.actualDataList},{name:"测试",type:"line",label:{normal:{show:!0,position:"top",formatter:"{c}",color:"black"}},data:this.testDataList}]})}}},r={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"burn-down-chart"}})},staticRenderFns:[]};var o=a("VU/8")(n,r,!1,function(t){a("QGcI")},"data-v-28d754e0",null);e.a=o.exports},e2nN:function(t,e){},yVxk:function(t,e){}});
//# sourceMappingURL=8.7fb6509ae531b5ff3dc6.js.map