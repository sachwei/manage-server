{"version":3,"sources":["webpack:///src/modules/sys/Org.vue","webpack:///./src/modules/sys/Org.vue?110d","webpack:///./src/modules/sys/Org.vue"],"names":["Org","orgList","_this","this","id","initParam","initData","ccHeadUrl","_this2","data","findAllOrg","findAllRole","nodeData","saveOrg","updateOrg","_this3","pop","_this4","orgBm","orgId","pid","_this5","_id","_this6","h","node","label","style","attrs","type","roleIds","sys_Org","render","_vm","_h","$createElement","_c","_self","staticClass","size","icon","on","click","addOrg","_v","orgTreeData","props","defaultProps","default-expand-all","expand-on-click-node","render-content","renderContent","node-click","orgNodeClick","_l","user","key","class","sex","src","headUrl","email","_s","userName","roleFormatter","title","orgTitle","visible","addOrgDialog","width","update:visible","$event","staticStyle","model","orgForm","label-width","options","change-on-select","clearable","value","callback","$$v","orgParent","expression","prop","placeholder","$set","slot","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"oJAoDA,IAAAA,iDAKA,iBAEA,qBAEA,WAEA,gBACA,0CAGA,eACA,uDAMA,yEAIAC,iCAEA,IAAAC,EAAAC,sFAGA,kCAEAC,kDAMA,KAEA,+BAKAC,iBACAC,uEAIAC,+BAEA,IAAAC,EAAAL,2DAEAM,IACAC,2DAEAD,uBAEA,OAEA,UACAE,4CAEAF,0CAIAG,8CAKAC,eAEAC,gCAGA,IAAAC,EAAAZ,8DACAa,qGAEAP,mBACA,0BAGA,IAAAQ,EAAAd,yHAEA,4FAIAC,oCACAH,gCACA,gCAEAiB,oBAGAC,KAEAD,qBACA,qBACA,2EAGAE,kBACAX,oBACA,qBACA,2BAEA,IAAAY,EAAAlB,6IAEAmB,qCAGA,IAAAC,EAAApB,+BACA,OAAAqB,eACA,oIACAA,EAAA,QAAAA,EAAA,QAAAC,EAEAC,UAAAF,EAAA,QAAAA,EAAA,aAAAG,MAAA,8BAAAC,OAAAC,KAAA,yDAEA,iBADAL,EAAA,aAAAG,MAAA,8BAAAC,OAAAC,KAAA,wDAEA,iBAAAL,EAAA,aAAAG,MAAA,8BAAAC,OAAAC,KAAA,6DAIA,8GAGAC,YCpLAC,GADiBC,OAFjB,WAA0B,IAAAC,EAAA9B,KAAa+B,EAAAD,EAAAE,eAA0BC,EAAAH,EAAAI,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,SAAAA,EAAA,OAA6BE,YAAA,gBAA0BF,EAAA,OAAYE,YAAA,SAAmBF,EAAA,OAAYE,YAAA,gBAA0BF,EAAA,aAAkBR,OAAOW,KAAA,QAAAV,KAAA,UAAAW,KAAA,gBAAsDC,IAAKC,MAAAT,EAAAU,UAAoBV,EAAAW,GAAA,YAAAX,EAAAW,GAAA,KAAAR,EAAA,WAA+CR,OAAOnB,KAAAwB,EAAAY,YAAAC,MAAAb,EAAAc,aAAAC,sBAAA,EAAAC,wBAAA,EAAAC,iBAAAjB,EAAAkB,eAA0IV,IAAKW,aAAAnB,EAAAoB,iBAA+B,GAAApB,EAAAW,GAAA,KAAAR,EAAA,OAA4BE,YAAA,SAAoBL,EAAAqB,GAAArB,EAAA,qBAAAsB,GAAyC,OAAAnB,EAAA,OAAiBoB,IAAAD,EAAAjC,IAAAgB,YAAA,YAAAmB,OAAA,IAAAF,EAAAG,IAAA,uBAAoFtB,EAAA,OAAYE,YAAA,YAAAV,OAA+B+B,IAAA1B,EAAA2B,QAAAL,EAAAM,SAAgC5B,EAAAW,GAAA,KAAAR,EAAA,OAAwBE,YAAA,cAAwBF,EAAA,QAAaE,YAAA,cAAwBL,EAAAW,GAAAX,EAAA6B,GAAAP,EAAAQ,aAAA9B,EAAAW,GAAA,KAAAR,EAAA,QAAyDE,YAAA,cAAwBL,EAAAW,GAAAX,EAAA6B,GAAA7B,EAAA+B,cAAAT,cAAgDtB,EAAAW,GAAA,KAAAR,EAAA,aAA+BR,OAAOqC,MAAAhC,EAAAiC,SAAAC,QAAAlC,EAAAmC,aAAAC,MAAA,OAA8D5B,IAAK6B,iBAAA,SAAAC,GAAkCtC,EAAAmC,aAAAG,MAA0BnC,EAAA,WAAgBoC,aAAaH,MAAA,OAAczC,OAAQ6C,MAAAxC,EAAAyC,QAAAC,cAAA,WAA2CvC,EAAA,gBAAqBR,OAAOF,MAAA,SAAeU,EAAA,eAAoBR,OAAOgD,QAAA3C,EAAAY,YAAAgC,mBAAA,GAAAC,UAAA,GAAAhC,MAAAb,EAAAa,OAAiF2B,OAAQM,MAAA9C,EAAA,UAAA+C,SAAA,SAAAC,GAA+ChD,EAAAiD,UAAAD,GAAkBE,WAAA,gBAAyB,GAAAlD,EAAAW,GAAA,KAAAR,EAAA,gBAAqCR,OAAOF,MAAA,KAAA0D,KAAA,UAA4BhD,EAAA,YAAiBR,OAAOyD,YAAA,SAAsBZ,OAAQM,MAAA9C,EAAAyC,QAAA,KAAAM,SAAA,SAAAC,GAAkDhD,EAAAqD,KAAArD,EAAAyC,QAAA,OAAAO,IAAmCE,WAAA,mBAA4B,OAAAlD,EAAAW,GAAA,KAAAR,EAAA,OAAgCE,YAAA,gBAAAV,OAAmC2D,KAAA,UAAgBA,KAAA,WAAenD,EAAA,aAAkBR,OAAOW,KAAA,SAAeE,IAAKC,MAAA,SAAA6B,GAAyBtC,EAAAmC,cAAA,MAA2BnC,EAAAW,GAAA,QAAAX,EAAAW,GAAA,KAAAR,EAAA,aAA6CR,OAAOW,KAAA,QAAAV,KAAA,WAAgCY,IAAKC,MAAA,SAAA6B,GAAyBtC,EAAApB,cAAgBoB,EAAAW,GAAA,uBAE/hE4C,oBCEjB,IAcAC,EAdAC,EAAA,OAcAC,CACA3F,EACA+B,GATA,EAXA,SAAA6D,GACAF,EAAA,QACAA,EAAA,SAaA,kBAEA,MAUAG,EAAA,QAAAJ,EAAA","file":"static/js/17.626d34e099bee8228a2d.js","sourcesContent":["<template>\r\n  <panel>\r\n    <div class=\"org-wrapper\">\r\n      <div class=\"left\">\r\n        <div class=\"org-toolbar\">\r\n          <el-button @click=\"addOrg\" size=\"small\" type=\"primary\" icon=\"el-icon-plus\">新增</el-button>\r\n        </div>\r\n        <el-tree\r\n          :data=\"orgTreeData\"\r\n          :props=\"defaultProps\"\r\n          :default-expand-all = \"true\"\r\n          :expand-on-click-node = \"false\"\r\n          @node-click=\"orgNodeClick\"\r\n          :render-content=\"renderContent\">\r\n        </el-tree>\r\n      </div>\r\n      <div class=\"right\">\r\n        <div v-for=\"user in curUserList\" :key=\"user._id\" class=\"user-item\" :class=\"[user.sex === 0 ? 'woman-bg' : 'man-bg']\">\r\n          <img class=\"headPhoto\" :src=\"headUrl + user.email\"/>\r\n          <div class=\"user-info\">\r\n            <span class=\"user-name\">{{ user.userName }}</span>\r\n            <span class=\"role-name\">{{ roleFormatter(user) }}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 组织编辑 -->\r\n      <el-dialog :title=\"orgTitle\" :visible.sync=\"addOrgDialog\" width=\"40%\">\r\n        <el-form :model=\"orgForm\" style=\"width:90%\" label-width=\"100px\">\r\n          <el-form-item label=\"父编码\">\r\n            <el-cascader\r\n                :options=\"orgTreeData\"\r\n                change-on-select\r\n                clearable\r\n                :props=\"props\"\r\n                v-model=\"orgParent\"\r\n              ></el-cascader>\r\n          </el-form-item>\r\n          <el-form-item label=\"名称\" prop=\"name\">\r\n            <el-input v-model=\"orgForm.name\" placeholder=\"请输入名称\"></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <div slot=\"footer\" class=\"dialog-footer\">\r\n          <el-button size=\"small\" @click=\"addOrgDialog = false\">取消</el-button>\r\n          <el-button size=\"small\" type=\"primary\" @click=\"saveOrg()\">保存</el-button>\r\n        </div>\r\n      </el-dialog>\r\n    </div>\r\n  </panel>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data () {\r\n    return {\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'name'\r\n      },\r\n      props: {\r\n        value: 'id',\r\n        label: 'name'\r\n      },\r\n      headUrl: '',\r\n      userList: [],\r\n      orgParent: [],\r\n      addOrgDialog: false,\r\n      addOrgState: true,\r\n      curOrg: {},\r\n      orgList: [],\r\n      orgForm: {},\r\n      roleList: [],\r\n      maxOrgId: 0\r\n    }\r\n  },\r\n  computed: {\r\n    orgTreeData () {\r\n      return this.$utils.arrayToTree(this.orgList)\r\n    },\r\n    curUserList () {\r\n      return this.userList.filter((user) => {\r\n        if (this.curOrg.id === -1) {\r\n          return user.orgId === undefined || user.orgId === null\r\n        } else {\r\n          return user.orgId === this.curOrg.id\r\n        }\r\n      })\r\n    },\r\n    orgTitle () {\r\n      if (this.addOrgState) {\r\n        return '新增'\r\n      } else {\r\n        return '编辑'\r\n      }\r\n    }\r\n  },\r\n  mounted () {\r\n    this.initParam()\r\n    this.initData()\r\n  },\r\n  methods: {\r\n    initParam () {\r\n      this.headUrl = this.$ccService.ccHeadUrl\r\n    },\r\n    initData () {\r\n      this.findAllUser().then((data) => {\r\n        this.userList = data\r\n        return this.findAllOrg()\r\n      }).then((data) => {\r\n        this.orgList = [].concat(data)\r\n        this.orgList.push({\r\n          id: -1,\r\n          name: '未分配'\r\n        })\r\n        return this.findAllRole()\r\n      }).then((data) => {\r\n        this.roleList = data\r\n      })\r\n    },\r\n    orgNodeClick (nodeData) {\r\n      this.curOrg = nodeData\r\n    },\r\n\r\n    onSaveOrg () {\r\n      if (this.addOrgState) {\r\n        this.saveOrg()\r\n      } else {\r\n        this.updateOrg()\r\n      }\r\n    },\r\n    saveOrg () {\r\n      this.orgForm.pid = this.orgParent && this.orgParent.slice(0).pop()\r\n      this.$dataService.save(this.$apiUrl.SYS_SAVE_ORG, this.orgForm).then((data) => {\r\n        this.orgList.push(data)\r\n        this.addOrgDialog = false\r\n      })\r\n    },\r\n    updateOrg () {\r\n      this.$dataService.save(this.$apiUrl.SYS_UPDATE_ORG + this.orgModel._id, this.orgForm).then((data) => {\r\n        this.addOrgDialog = false\r\n      })\r\n    },\r\n    addOrg (node) {\r\n      this.orgParent = node.id && this.$utils.getCascadeValue(this.orgTreeData, node.id)\r\n      let orgId = this.$utils.getMaxId(this.orgList)\r\n      let orgBm = String(orgId).padStart(4, '0')\r\n      if (this.orgParent) {\r\n        orgBm = '' + node.bm + orgBm\r\n      }\r\n      this.orgForm = {\r\n        'id': orgId,\r\n        'bm': orgBm\r\n      }\r\n      this.addOrgState = true\r\n      this.addOrgDialog = true\r\n    },\r\n    editOrg (data) {\r\n      this.orgParent = data.pid && this.$utils.getCascadeValue(data.pid)\r\n      this.orgForm = data\r\n      this.addOrgState = false\r\n      this.addOrgDialog = true\r\n    },\r\n    deleteOrg (node, data) {\r\n      this.$dataService.deleteById(this.$apiUrl.SYS_DELETE_ORG + data._id).then(() => {\r\n        this.orgList = this.orgList.filter(item => item._id !== data._id)\r\n      })\r\n    },\r\n    renderContent (h, { node, data, store }) {\r\n      return (\r\n        <div style='flex: 1; height: 80px; display: flex; align-items: center; justify-content: space-between; font-size: 14px; padding-right: 8px;'>\r\n          <span>\r\n            <span>{node.label}</span>\r\n          </span>\r\n          <span>\r\n            <el-button style=\"font-size: 14px;color:#333;\" type=\"text\" on-click={ () => this.editOrg(data) } class=\"el-icon-edit\" ></el-button>\r\n            <el-button style=\"font-size: 14px;color:#333;\" type=\"text\" on-click={ () => this.addOrg(data) } class=\"el-icon-plus\" ></el-button>\r\n            <el-button style=\"font-size: 14px;color:#333;\" type=\"text\" on-click={ () => this.deleteOrg(node, data) } class=\"el-icon-delete\" ></el-button>\r\n          </span>\r\n        </div>\r\n      )\r\n    },\r\n    roleFormatter (row) {\r\n      return row.roleIds && this.$utils.dataFormatter(this.roleList, row.roleIds)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n  .el-tree-node__content {\r\n    height: 42px;\r\n  }\r\n</style>\r\n\r\n<style lang=\"scss\" scoped>\r\n  .org-wrapper{\r\n    display: flex;\r\n    height: 100%;\r\n  }\r\n\r\n  .footer {\r\n    display: flex;\r\n    justify-content: flex-end;\r\n  }\r\n\r\n  .left{\r\n    flex: 0 0 300px;\r\n    width: 300px;\r\n\r\n    .org-toolbar{\r\n      margin-bottom: 10px;\r\n    }\r\n  }\r\n\r\n  .right{\r\n    height: 100%;\r\n    flex: 1 1 auto;\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    background-color: #ececec;\r\n    overflow-y: auto;\r\n    align-content: flex-start;\r\n  }\r\n\r\n  .woman-bg{\r\n    background: url(../../assets/img/icon_usercard_woman.png);\r\n  }\r\n\r\n  .man-bg{\r\n    background: url(../../assets/img/icon_usercard_man.png);\r\n  }\r\n\r\n  .user-item:hover{\r\n    box-shadow: 2px 2px 2px 2px #ddd;\r\n  }\r\n\r\n  .user-item {\r\n    background-color: white;\r\n    height: 88px;\r\n    width: 260px;\r\n    margin: 10px;\r\n    border-top-right-radius: 2px;\r\n    border-bottom-right-radius: 2px;\r\n    background-position: bottom right;\r\n    background-repeat: no-repeat;\r\n    display: flex;\r\n    cursor: pointer;\r\n    transition: all .3s;\r\n\r\n    .headPhoto{\r\n      height: 88px;\r\n      width: 88px;\r\n      vertical-align: center;\r\n    }\r\n\r\n    .user-info{\r\n      display: flex;\r\n      flex-direction: column;\r\n      text-overflow: ellipsis;\r\n\r\n      .user-name{\r\n        margin-top: 20px;\r\n        margin-left: 20px;\r\n        font-size: 14px;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .role-name{\r\n        font-size: 12px;\r\n        margin: 8px 0 0 20px;\r\n        color: rgba(0,0,0,.7);\r\n      }\r\n    }\r\n  }\r\n</style>\r\n\n\n\n// WEBPACK FOOTER //\n// src/modules/sys/Org.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('panel',[_c('div',{staticClass:\"org-wrapper\"},[_c('div',{staticClass:\"left\"},[_c('div',{staticClass:\"org-toolbar\"},[_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\",\"icon\":\"el-icon-plus\"},on:{\"click\":_vm.addOrg}},[_vm._v(\"新增\")])],1),_vm._v(\" \"),_c('el-tree',{attrs:{\"data\":_vm.orgTreeData,\"props\":_vm.defaultProps,\"default-expand-all\":true,\"expand-on-click-node\":false,\"render-content\":_vm.renderContent},on:{\"node-click\":_vm.orgNodeClick}})],1),_vm._v(\" \"),_c('div',{staticClass:\"right\"},_vm._l((_vm.curUserList),function(user){return _c('div',{key:user._id,staticClass:\"user-item\",class:[user.sex === 0 ? 'woman-bg' : 'man-bg']},[_c('img',{staticClass:\"headPhoto\",attrs:{\"src\":_vm.headUrl + user.email}}),_vm._v(\" \"),_c('div',{staticClass:\"user-info\"},[_c('span',{staticClass:\"user-name\"},[_vm._v(_vm._s(user.userName))]),_vm._v(\" \"),_c('span',{staticClass:\"role-name\"},[_vm._v(_vm._s(_vm.roleFormatter(user)))])])])})),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":_vm.orgTitle,\"visible\":_vm.addOrgDialog,\"width\":\"40%\"},on:{\"update:visible\":function($event){_vm.addOrgDialog=$event}}},[_c('el-form',{staticStyle:{\"width\":\"90%\"},attrs:{\"model\":_vm.orgForm,\"label-width\":\"100px\"}},[_c('el-form-item',{attrs:{\"label\":\"父编码\"}},[_c('el-cascader',{attrs:{\"options\":_vm.orgTreeData,\"change-on-select\":\"\",\"clearable\":\"\",\"props\":_vm.props},model:{value:(_vm.orgParent),callback:function ($$v) {_vm.orgParent=$$v},expression:\"orgParent\"}})],1),_vm._v(\" \"),_c('el-form-item',{attrs:{\"label\":\"名称\",\"prop\":\"name\"}},[_c('el-input',{attrs:{\"placeholder\":\"请输入名称\"},model:{value:(_vm.orgForm.name),callback:function ($$v) {_vm.$set(_vm.orgForm, \"name\", $$v)},expression:\"orgForm.name\"}})],1)],1),_vm._v(\" \"),_c('div',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{attrs:{\"size\":\"small\"},on:{\"click\":function($event){_vm.addOrgDialog = false}}},[_vm._v(\"取消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"small\",\"type\":\"primary\"},on:{\"click\":function($event){_vm.saveOrg()}}},[_vm._v(\"保存\")])],1)],1)],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-5f274b2d\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/modules/sys/Org.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-5f274b2d\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./Org.vue\")\n  require(\"!!../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-5f274b2d\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../node_modules/vue-loader/lib/selector?type=styles&index=1!./Org.vue\")\n}\nvar normalizeComponent = require(\"!../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Org.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../node_modules/vue-loader/lib/selector?type=script&index=0!./Org.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-5f274b2d\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../node_modules/vue-loader/lib/selector?type=template&index=0!./Org.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-5f274b2d\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/modules/sys/Org.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}