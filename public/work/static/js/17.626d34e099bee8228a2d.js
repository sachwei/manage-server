webpackJsonp([17],{"1rz7":function(t,e){},"31bh":function(t,e){},yUYh:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={data:function(){return{defaultProps:{children:"children",label:"name"},props:{value:"id",label:"name"},headUrl:"",userList:[],orgParent:[],addOrgDialog:!1,addOrgState:!0,curOrg:{},orgList:[],orgForm:{},roleList:[],maxOrgId:0}},computed:{orgTreeData:function(){return this.$utils.arrayToTree(this.orgList)},curUserList:function(){var t=this;return this.userList.filter(function(e){return-1===t.curOrg.id?void 0===e.orgId||null===e.orgId:e.orgId===t.curOrg.id})},orgTitle:function(){return this.addOrgState?"新增":"编辑"}},mounted:function(){this.initParam(),this.initData()},methods:{initParam:function(){this.headUrl=this.$ccService.ccHeadUrl},initData:function(){var t=this;this.findAllUser().then(function(e){return t.userList=e,t.findAllOrg()}).then(function(e){return t.orgList=[].concat(e),t.orgList.push({id:-1,name:"未分配"}),t.findAllRole()}).then(function(e){t.roleList=e})},orgNodeClick:function(t){this.curOrg=t},onSaveOrg:function(){this.addOrgState?this.saveOrg():this.updateOrg()},saveOrg:function(){var t=this;this.orgForm.pid=this.orgParent&&this.orgParent.slice(0).pop(),this.$dataService.save(this.$apiUrl.SYS_SAVE_ORG,this.orgForm).then(function(e){t.orgList.push(e),t.addOrgDialog=!1})},updateOrg:function(){var t=this;this.$dataService.save(this.$apiUrl.SYS_UPDATE_ORG+this.orgModel._id,this.orgForm).then(function(e){t.addOrgDialog=!1})},addOrg:function(t){this.orgParent=t.id&&this.$utils.getCascadeValue(this.orgTreeData,t.id);var e=this.$utils.getMaxId(this.orgList),r=String(e).padStart(4,"0");this.orgParent&&(r=""+t.bm+r),this.orgForm={id:e,bm:r},this.addOrgState=!0,this.addOrgDialog=!0},editOrg:function(t){this.orgParent=t.pid&&this.$utils.getCascadeValue(t.pid),this.orgForm=t,this.addOrgState=!1,this.addOrgDialog=!0},deleteOrg:function(t,e){var r=this;this.$dataService.deleteById(this.$apiUrl.SYS_DELETE_ORG+e._id).then(function(){r.orgList=r.orgList.filter(function(t){return t._id!==e._id})})},renderContent:function(t,e){var r=this,i=e.node,a=e.data;e.store;return t("div",{style:"flex: 1; height: 80px; display: flex; align-items: center; justify-content: space-between; font-size: 14px; padding-right: 8px;"},[t("span",[t("span",[i.label])]),t("span",[t("el-button",{style:"font-size: 14px;color:#333;",attrs:{type:"text"},on:{click:function(){return r.editOrg(a)}},class:"el-icon-edit"}),t("el-button",{style:"font-size: 14px;color:#333;",attrs:{type:"text"},on:{click:function(){return r.addOrg(a)}},class:"el-icon-plus"}),t("el-button",{style:"font-size: 14px;color:#333;",attrs:{type:"text"},on:{click:function(){return r.deleteOrg(i,a)}},class:"el-icon-delete"})])])},roleFormatter:function(t){return t.roleIds&&this.$utils.dataFormatter(this.roleList,t.roleIds)}}},a={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("panel",[r("div",{staticClass:"org-wrapper"},[r("div",{staticClass:"left"},[r("div",{staticClass:"org-toolbar"},[r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:t.addOrg}},[t._v("新增")])],1),t._v(" "),r("el-tree",{attrs:{data:t.orgTreeData,props:t.defaultProps,"default-expand-all":!0,"expand-on-click-node":!1,"render-content":t.renderContent},on:{"node-click":t.orgNodeClick}})],1),t._v(" "),r("div",{staticClass:"right"},t._l(t.curUserList,function(e){return r("div",{key:e._id,staticClass:"user-item",class:[0===e.sex?"woman-bg":"man-bg"]},[r("img",{staticClass:"headPhoto",attrs:{src:t.headUrl+e.email}}),t._v(" "),r("div",{staticClass:"user-info"},[r("span",{staticClass:"user-name"},[t._v(t._s(e.userName))]),t._v(" "),r("span",{staticClass:"role-name"},[t._v(t._s(t.roleFormatter(e)))])])])})),t._v(" "),r("el-dialog",{attrs:{title:t.orgTitle,visible:t.addOrgDialog,width:"40%"},on:{"update:visible":function(e){t.addOrgDialog=e}}},[r("el-form",{staticStyle:{width:"90%"},attrs:{model:t.orgForm,"label-width":"100px"}},[r("el-form-item",{attrs:{label:"父编码"}},[r("el-cascader",{attrs:{options:t.orgTreeData,"change-on-select":"",clearable:"",props:t.props},model:{value:t.orgParent,callback:function(e){t.orgParent=e},expression:"orgParent"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"名称",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入名称"},model:{value:t.orgForm.name,callback:function(e){t.$set(t.orgForm,"name",e)},expression:"orgForm.name"}})],1)],1),t._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{attrs:{size:"small"},on:{click:function(e){t.addOrgDialog=!1}}},[t._v("取消")]),t._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){t.saveOrg()}}},[t._v("保存")])],1)],1)],1)])},staticRenderFns:[]};var s=r("VU/8")(i,a,!1,function(t){r("31bh"),r("1rz7")},"data-v-5f274b2d",null);e.default=s.exports}});
//# sourceMappingURL=17.626d34e099bee8228a2d.js.map