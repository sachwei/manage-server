webpackJsonp([12],{"DU+v":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("Dd8w"),i=a.n(s),n=[{value:"h5"},{value:"android"},{value:"ios"},{value:"web"},{value:"java"},{value:"study"}],l={props:["value","userList"],data:function(){return{tyeps:n}},methods:{onDelete:function(){this.$emit("delete",this.value)},taskItemChange:function(){this.$emit("change",this.value)}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-item-wrapper"},[a("el-select",{staticClass:"task-item-space",staticStyle:{width:"200px"},attrs:{placeholder:"请选择"},on:{change:t.taskItemChange},model:{value:t.value.type,callback:function(e){t.$set(t.value,"type",e)},expression:"value.type"}},t._l(t.tyeps,function(t){return a("el-option",{key:t.value,attrs:{label:t.value,value:t.value}})})),t._v(" "),a("el-input-number",{staticClass:"task-item-space",attrs:{"controls-position":"right",step:.5,min:.5,max:10},model:{value:t.value.estimate,callback:function(e){t.$set(t.value,"estimate",e)},expression:"value.estimate"}}),t._v(" "),a("el-select",{staticClass:"task-item-space",attrs:{clearable:!0,filterable:"",placeholder:"请选择"},model:{value:t.value.userId,callback:function(e){t.$set(t.value,"userId",e)},expression:"value.userId"}},t._l(t.userList,function(t){return a("el-option",{key:t.email,attrs:{label:t.userName,value:t.email}})})),t._v(" "),a("el-input",{staticClass:"task-item-space task-item-note",attrs:{placeholder:"备注"},model:{value:t.value.note,callback:function(e){t.$set(t.value,"note",e)},expression:"value.note"}}),t._v(" "),a("i",{staticClass:"fa fa-trash-o fa-lg",on:{click:t.onDelete}})],1)},staticRenderFns:[]};var r=a("VU/8")(l,o,!1,function(t){a("wAmr")},"data-v-5c1f60db",null).exports,c=a("NYxO"),u={components:{taskItem:r},data:function(){return{tableName:"backlogs",sprintList:[],findCondition:{},curSprint:{},taskList:[{type:"h5",estimate:1,createDate:new Date},{type:"java",estimate:1,createDate:new Date},{type:"web",estimate:1,createDate:new Date}],backlog:{}}},computed:{userList:function(){return this.$store.state.userList}},methods:i()({initParam:function(){this.findCondition={productId:this.$store.state.backlog.product.id,state:1};var t=this.$route.params.id;this.backlog=this.$store.getters.getBacklog(t),this.backlog.tasks&&0===this.backlog.tasks.length&&(this.backlog.tasks=this.taskList)},initData:function(){var t=this;this.findDataByCondition("sprints").then(function(e){t.sprintList=e})},onAddTask:function(){this.backlog.tasks.push({createDate:new Date})},validate:function(){var t=!0;this.curSprint.id||(t=!1,this.$message("请选择所属sprint")),0===this.backlog.tasks.length&&(t=!1,this.$message("请添加至少一条估算数据。"));for(var e=0,a=this.backlog.tasks.length;e<a;e++){if(!this.backlog.tasks[e].type){t=!1,this.$message("存在任务类型为空。");break}if(!this.backlog.tasks[e].estimate){t=!1,this.$message("存在估算时间为空。");break}}return t},onSaveBack:function(){var t=this;if(this.validate())return this.backlog.sprintId=this.curSprint.id,this.setEstimate(),this.curData=this.backlog,this.doUpdate().then(function(){t.updateBacklog(t.curData),t.goBack()})},updateSprint:function(t){var e=this.curSprint.backlogs;e.push(this.backlog.id);var a={backlog:e};return this.$dataService.update(this.$apiUrl.BASE_UPDATE+"sprints/"+this.curSprint._id,a)},onTaskItemDelete:function(t){this.backlog.tasks=this.backlog.tasks.filter(function(e){return e.type!==t.type})},onTaskItemChange:function(t){for(var e=0,a=0,s=this.backlog.tasks.length;a<s;a++)this.backlog.tasks[a].type===t.type&&(e+=1)>1&&(this.$message("已存在相同的任务类型。"),this.backlog.tasks[a].type="")},setEstimate:function(){for(var t=0,e=0,a=this.backlog.tasks.length;e<a;e++)t+=this.backlog.tasks[e].estimate;this.backlog.estimate=t}},Object(c.d)(["updateBacklog"]))},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("panel",[a("div",{staticClass:"estimate-wrapper"},[a("radio-group",{attrs:{list:t.sprintList},model:{value:t.curSprint,callback:function(e){t.curSprint=e},expression:"curSprint"}}),t._v(" "),a("div",{staticClass:"estimate-body"},[a("transition-group",{attrs:{name:"flip-list"}},t._l(t.backlog.tasks,function(e,s){return a("task-item",{key:s,attrs:{value:e,userList:t.userList},on:{change:function(a){t.onTaskItemChange(e)},delete:function(a){t.onTaskItemDelete(e)}}})})),t._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-plus",circle:""},on:{click:t.onAddTask}})],1),t._v(" "),a("div",{staticClass:"estimate-footer"},[a("el-button",{on:{click:t.goBack}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.onSaveBack}},[t._v("保存")])],1)],1)])},staticRenderFns:[]};var k=a("VU/8")(u,p,!1,function(t){a("pn+2"),a("csHL")},"data-v-41dba403",null);e.default=k.exports},csHL:function(t,e){},"pn+2":function(t,e){},wAmr:function(t,e){}});
//# sourceMappingURL=12.2d6950e2d5f78168ba53.js.map