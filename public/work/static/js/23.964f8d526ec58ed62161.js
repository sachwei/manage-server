webpackJsonp([23],{M5Jj:function(t,e){},dipN:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s={data:function(){return{addDialogVisible:!1,dialogTitle:"",newPlanForm:{},planList:[],user:{},classifyList:[],typeList:[],classifyChecks:[],typeChecks:[],searchText:""}},computed:{filterPlanlist:function(){var t=[this.classifyChecks.join(","),this.typeChecks.join(",")],e=t[0],a=t[1],s=this.searchText;return this.planList.filter(function(t){return e&&a?-1!==e.indexOf(t.classify)&&-1!==a.indexOf(t.type)&&-1!==t.summary.indexOf(s):e&&!a?-1!==e.indexOf(t.classify)&&-1!==t.summary.indexOf(s):!e&&a?-1!==a.indexOf(t.type)&&-1!==t.summary.indexOf(s):-1!==t.summary.indexOf(s)})},monthList:function(){for(var t=[],e=0;e<this.planList.length;e++){var a=this.planList[e],s=new Date(a.planDate).getMonth()+1;t.includes(s)||t.push(s)}return t.sort(function(t,e){return t-e}),t}},methods:{initData:function(){this.initEnums()},initEnums:function(){var t=this;this.$enumService.getEnum("YEAR_PLAN_CLASSIFY").then(function(e){return t.classifyList=e,t.$enumService.getEnum("YEAR_PLAN_TYPE")}).then(function(e){t.typeList=e,t.findAllPlan()})},findAllPlan:function(){var t=this;this.$dataService.find(this.$apiUrl.WORK_ALL_PLAN).then(function(e){t.planList=e,t.planList.sort(t.planSort)})},planSort:function(t,e){return e.sort-t.sort},onChangeState:function(t){this.newPlanForm=t,t.state=Math.abs(t.state-1),this.doUpdatePlan()},onPlanEdit:function(t){this.dialogTitle="修改",this.newPlanForm=t,this.addDialogVisible=!0},getMonthPlanList:function(t){return this.filterPlanlist.filter(function(e){return new Date(e.planDate).getMonth()+1===t})},newPlan:function(){this.newPlanForm={id:this.$utils.getMaxId(this.planList),summary:"",classify:"",type:"",sort:50,planDate:new Date,state:0,userId:this.user.email}},onAddPlan:function(){this.dialogTitle="新增",this.newPlan(),this.addDialogVisible=!0},onSavePlan:function(){this.newPlanForm._id?this.doUpdatePlan():this.doSavePlan()},doUpdatePlan:function(){var t=this;this.$dataService.update(this.$apiUrl.WORK_UPDATE_PLAN+this.newPlanForm._id,this.newPlanForm).then(function(e){t.addDialogVisible=!1})},doSavePlan:function(){var t=this;this.$dataService.save(this.$apiUrl.WORK_SAVE_PLAN,this.newPlanForm).then(function(e){t.planList.push(e),t.addDialogVisible=!1})}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("panel",[a("div",{staticClass:"year-plan-wrapper"},[a("div",{staticClass:"toolbar"},[a("div",{staticClass:"left"},[a("el-input",{attrs:{size:"small",placeholder:"请输入搜索内容","prefix-icon":"el-icon-search"},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}}),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"新建",placement:"top-start"}},[a("el-button",{staticClass:"add-btn",attrs:{size:"mini",type:"success",icon:"el-icon-plus",circle:""},on:{click:t.onAddPlan}})],1)],1),t._v(" "),a("div",{staticClass:"right"},[a("checkbox-group",{attrs:{enumTypeId:"YEAR_PLAN_CLASSIFY"},model:{value:t.classifyChecks,callback:function(e){t.classifyChecks=e},expression:"classifyChecks"}}),t._v(" "),a("checkbox-group",{staticClass:"type",attrs:{enumTypeId:"YEAR_PLAN_TYPE"},model:{value:t.typeChecks,callback:function(e){t.typeChecks=e},expression:"typeChecks"}})],1)]),t._v(" "),a("hr",{staticClass:"lists-separator"}),t._v(" "),a("div",{staticClass:"plan"},t._l(t.monthList,function(e){return a("div",{key:e,staticClass:"month-plan"},[a("div",{staticClass:"month-plan-content"},[a("div",{staticClass:"time-item"},[a("i",{staticClass:"fa fa-calendar"}),t._v(" "),a("span",[t._v(t._s(e)+"月")])]),t._v(" "),a("div",{staticClass:"work-item-list"},t._l(t.getMonthPlanList(e),function(e){return a("div",{key:e.id,staticClass:"work-item",class:{"work-item-done":1===e.state},style:{backgroundColor:"rgba(244,164,96,"+e.sort/100+")"},on:{dblclick:function(a){t.onPlanEdit(e)}}},[a("div",{staticClass:"left"},[a("div",{staticClass:"summary"},[t._v(t._s(e.summary))]),t._v(" "),a("div",{staticClass:"classify"},[t._v(t._s(t._f("enumFilter")(e.classify,"YEAR_PLAN_CLASSIFY")))]),t._v(" "),a("div",{staticClass:"note"},[t._v(t._s(e.note))])]),t._v(" "),a("div",{staticClass:"footer"},[1===e.state?a("i",{staticClass:"fa fa-dot-circle-o",on:{click:function(a){t.onChangeState(e)}}}):a("i",{staticClass:"fa fa-circle-thin",on:{click:function(a){t.onChangeState(e)}}}),t._v(" "),a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:e.note}},[e.note?a("i",{staticClass:"fa fa-info-circle",attrs:{slot:"reference"},slot:"reference"}):t._e()])],1)])}))]),t._v(" "),a("hr",{staticClass:"lists-separator"})])}))]),t._v(" "),a("el-dialog",{attrs:{title:t.dialogTitle,visible:t.addDialogVisible,width:"40%"},on:{"update:visible":function(e){t.addDialogVisible=e}}},[a("el-form",{staticStyle:{width:"98%"},attrs:{model:t.newPlanForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{attrs:{"auto-complete":"off"},model:{value:t.newPlanForm.summary,callback:function(e){t.$set(t.newPlanForm,"summary",e)},expression:"newPlanForm.summary"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务分类"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择任务分类"},model:{value:t.newPlanForm.classify,callback:function(e){t.$set(t.newPlanForm,"classify",e)},expression:"newPlanForm.classify"}},t._l(t.classifyList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"任务类型"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"选择任务类型"},model:{value:t.newPlanForm.type,callback:function(e){t.$set(t.newPlanForm,"type",e)},expression:"newPlanForm.type"}},t._l(t.typeList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),a("el-form-item",{attrs:{label:"重要程度"}},[a("el-slider",{model:{value:t.newPlanForm.sort,callback:function(e){t.$set(t.newPlanForm,"sort",e)},expression:"newPlanForm.sort"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"计划时间"}},[a("el-date-picker",{attrs:{type:"date",placeholder:"选择月"},model:{value:t.newPlanForm.planDate,callback:function(e){t.$set(t.newPlanForm,"planDate",e)},expression:"newPlanForm.planDate"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{rows:2,type:"textarea","auto-complete":"off"},model:{value:t.newPlanForm.note,callback:function(e){t.$set(t.newPlanForm,"note",e)},expression:"newPlanForm.note"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small"},on:{click:function(e){t.addDialogVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.onSavePlan}},[t._v("保存")])],1)],1)],1)},staticRenderFns:[]};var n=a("VU/8")(s,i,!1,function(t){a("M5Jj")},"data-v-816bb858",null);e.default=n.exports}});
//# sourceMappingURL=23.964f8d526ec58ed62161.js.map